/* src/styles/base/responsive.css */

/* --- GLOBAL MOBILE TYPOGRAPHY (Fixing the "Zoomed In" feel) --- */
@media (max-width: 768px) {
    html {
        font-size: 14px; /* Slightly smaller base font */
    }
    
    h1, .location-text h1, .banner-title {
        font-size: 1.8rem !important; /* Cap massive headers */
    }
    
    h2, .action-box h3 {
        font-size: 1.2rem !important;
    }
    
    .storylet-container, .character-sheet, .sidebar-content-scroll {
        padding: 1.25rem !important; /* Reduce massive padding */
    }
    
    .location-header {
        padding: 1rem !important;
    }

    .main-content-wrapper, 
    .layout-column, 
    .content-area {
        width: 100% !important;
        max-width: 100vw !important;
        padding-left: 0rem !important;  
        padding-right: 0rem !important;
        margin: 0 !important;
    }

    /* Force images to fit */
    img {
        max-width: 100%;
        height: auto;
    }
    
}

/* --- TABLET (Max 1024px) --- */
@media (max-width: 1024px) {
    
    /* NEXUS: Stack Sidebar on top of Content */
    .layout-grid-nexus {
        grid-template-columns: 1fr; 
        grid-template-rows: auto 1fr;
        height: auto; 
        overflow-y: auto !important;
    }

    /* TABLETOP: Stack Visual -> Sidebar -> Content */
    .layout-grid-tabletop {
        display: flex !important; /* Switch to flex to control order easily */
        flex-direction: column;
        height: auto !important;
        overflow-y: auto !important;
    }

    /* Ensure Visual is Top */
    .tabletop-visual-col {
        order: 1;
        height: 250px;
        flex-shrink: 0;
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
    }

    /* Ensure Content is Middle */
    .layout-column.content-column {
        order: 2;
        width: 100% !important;
        min-width: 0 !important;
    }

    /* Sidebar Logic for Tablet/Mobile */
    .sidebar-panel {
        display: none !important; /* Hide by default on mobile/tablet */
        position: fixed !important;
        top: 0; left: 0; right: 0; bottom: 0;
        z-index: 9999;
        width: 100% !important;
        background-color: var(--bg-panel);
    }

    /* When toggled open */
    .sidebar-panel.mobile-visible {
        display: flex !important;
        flex-direction: column;
        
        /* Force full screen dimensions */
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        
        width: 100% !important;
        height: 100vh !important;
        height: 100dvh !important; /* Dynamic viewport height for mobile browsers */
        
        /* Reset any layout-specific restrictions */
        max-height: none !important; 
        transform: none !important;
        border: none !important;
        margin: 0 !important;
        
        /* Ensure background covers everything */
        background-color: var(--bg-main); 
        background-color: var(--bg-panel); /* Theme preference */
        
        overflow-y: hidden; /* Scroll handled by inner .sidebar-content-scroll */
    }
    .sidebar-panel {
        display: none; 
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        z-index: 9999;
        width: 100%;
        background-color: var(--bg-panel);
        padding: 0;
    }

    /* Specific fix for London Layout grid collapsing */
    .london-layout-container .layout-main-grid {
        display: flex;
        flex-direction: column;
        height: auto;
        overflow: visible;
        padding: 1rem;
    }

    .content-area {
        flex: 1;
        overflow-y: auto !important;
        position: relative;
        padding: 0 !important; 
    }

}

/* --- MOBILE SPECIFIC (Max 768px) --- */
@media (max-width: 768px) {

    /* --- GLOBAL TWEAKS --- */
    .container, .storylet-container {
        width: 100%;
        box-sizing: border-box;
        margin: 0 !important;
        border-left: none !important;
        border-right: none !important;
        border-radius: 0 !important;
    }

    /* --- ADMIN & EDITOR --- */
    .admin-layout, .editor-layout {
        flex-direction: column;
        height: auto;
        overflow-y: auto;
    }

    .admin-sidebar, .editor-sidebar {
        width: 100% !important;
        height: auto;
        position: static;
        flex-direction: row;
        overflow-x: auto;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
    }
    
    .admin-nav ul, .editor-toolbar {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        padding: 0.5rem;
    }

    .admin-main, .editor-main {
        height: auto;
        min-height: 500px;
    }

    .admin-split-view {
        flex-direction: column;
    }
    .admin-list-col {
        width: 100%;
        position: static;
        max-height: 300px;
        margin-bottom: 1rem;
    }

    /* --- GAMEPLAY --- */
    .storylet-main-content {
        flex-direction: column;
    }
    .storylet-image-container {
        width: 100%;
        max-width: 100%;
        margin-bottom: 1rem;
    }
    .storylet-image {
        aspect-ratio: 16/9;
    }
    
    .option-content-wrapper {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    .option-image-container {
        width: 80px;
        margin-bottom: 0.5rem;
    }
    .tab-bar {
        display: flex;
        width: 100%;
    }
    
    .tab-btn {
        flex: 1;
        text-align: center;
        padding: 1rem 0.5rem; /* Adjust padding for touch targets */
    }

    .theme-wrapper, 
    .main-content-wrapper, 
    .layout-column, 
    .content-area,
    .hub-view,
    .event-view {
        width: 100% !important;
        max-width: 100vw !important; /* Hard stop at viewport width */
        /* overflow-x: hidden !important; Clip anything that tries to escape */
        box-sizing: border-box !important;
    }

    /* 2. RESPONSIVE LOCATION HEADER (Stacks vertically on mobile) */
    .location-header {
        flex-direction: column !important;
        align-items: center !important;
        text-align: center !important;
        gap: 1rem !important;
        width: 100% !important;
    }

    /* The "Image + Text" group inside the header */
    .location-header > div:first-child {
        flex-direction: column !important;
        gap: 0.5rem !important;
        width: 100%;
        align-items: center !important;
    }

    /* The "Market/Travel" Buttons group */
    .location-header > div:last-child {
        width: 100%;
        justify-content: center !important;
        flex-wrap: wrap !important; /* Allow buttons to wrap if names are long */
        margin-top: 0.5rem;
    }

    /* 3. RESPONSIVE TAB BAR */
    .tab-bar {
        display: flex;
        flex-wrap: wrap; /* Allow tabs to wrap if screen is tiny */
        width: 100%;
    }
    
    .tab-btn {
        flex: 1 1 auto; /* Grow to fill, but shrink if needed */
        min-width: 80px; /* Prevent crushing */
        font-size: 0.8rem;
        padding: 0.8rem 0.5rem;
    }

    /* 4. TABLETOP SPECIFICS (Your screenshot) */
    .visual-nav-buttons {
        width: 100%;
        padding: 0 1rem;
        box-sizing: border-box;
        flex-wrap: wrap; /* Allow buttons to stack if needed */
    }

    /* EDITOR MOBILE TWEAKS */
    .editor-sidebar-collapsed-text {
        writing-mode: horizontal-tb !important; /* Force Horizontal text */
        transform: none !important; /* Remove rotation */
        letter-spacing: 1px;
        font-size: 0.7rem;
    }
    
    .editor-sidebar {
        min-height: 40px; /* Ensure click target is big enough */
    }

    html {
        /* Default is usually 16px. Setting to 14px makes 1rem = 14px.
           This effectively zooms the entire UI out by ~12%. */
        font-size: 14px; 
    }
}

/* src/styles/base/responsive.css */

/* --- GLOBAL DENSITY SCALING (The "Zoom Out") --- */
@media (max-width: 768px) {
    html {
        /* Standard is 16px. Setting to 12px shrinks the entire UI by 25%.
           If this is still too big, try 11px. */
        font-size: 12px; 
    }

    /* Shrink the massive headers */
    h1, .location-text h1, .banner-title, .profile-name {
        font-size: 1.8rem !important; /* Was ~3rem */
        line-height: 1.1;
    }
    
    h2, .action-box h3 {
        font-size: 1.3rem !important;
    }

    /* Tighten the gaps */
    .container, 
    .storylet-container, 
    .main-content-wrapper,
    .admin-content-wrapper {
        padding-left: 10px !important;
        padding-right: 10px !important; 
        width: 100% !important;
        max-width: 100vw !important;
        box-sizing: border-box !important;
        margin-bottom: 6rem !important;
    }
    
    /* Ensure images don't blow out the width */
    img {
        max-width: 100%;
        height: auto;
    }
    
    .inventory-grid {
        /* Override the inline JS style with !important */
        --inv-item-width: 100% !important;
        
        /* Force a single column layout */
        display: grid !important;
        grid-template-columns: 1fr !important;
        
        /* Ensure it stays within bounds */
        width: 100% !important;
        box-sizing: border-box !important;
        gap: 1rem !important;
    }

    .inventory-item {
        width: 100% !important;
        max-width: none !important;
        box-sizing: border-box !important;
    }
    
    /* Ensure the internal image/text layout stacks or shrinks correctly */

    
    .inventory-item .item-image-container {
        width: 100%;
        /* height: 100px !important; Give image a fixed height when stacked */
        margin-bottom: 0.5rem;
    }

    
}

/* --- ADMIN SPECIFIC DENSITY --- */
@media (max-width: 900px) {
    /* Make the admin sidebar/list compact */
    .admin-list-col {
        min-height: 100px;
        max-height: 180px !important;
    }
    
    /* Allow form inputs to sit side-by-side if they fit */
    .form-row {
        display: flex;
        gap: 0.5rem !important;
    }
    
    .form-group {
        margin-bottom: 0.8rem !important;
    }
    
    /* Make inputs smaller but still tappable */
    .form-input, .form-select {
        padding: 0.4rem !important;
        font-size: 1rem !important; /* 12px based on root */
    }
}

/* --- TABLET/MOBILE LAYOUT LOGIC --- */
@media (max-width: 1024px) {
    /* Collapse Nexus Grid */
    .layout-grid-nexus {
        grid-template-columns: 1fr; 
        grid-template-rows: auto 1fr;
        height: auto; 
        overflow-y: auto;
    }

    /* Collapse Tabletop Grid */
    .layout-grid-tabletop {
        display: flex !important;
        flex-direction: column;
        height: auto !important;
        overflow-y: auto !important;
    }

    /* Visual on top */
    .tabletop-visual-col {
        order: 1;
        height: 200px; /* Reduced height */
        width: 100%;
    }

    .layout-column.content-column {
        order: 2;
    }

    /* Hide Sidebar by default (Drawer logic) */
    .sidebar-panel {
        display: none; 
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        z-index: 9999;
        width: 100%;
        background-color: var(--bg-panel);
    }

    .sidebar-panel.mobile-visible {
        display: flex !important;
    }
    
    /* Ensure collapsed sidebar text is horizontal */
    .editor-sidebar-collapsed-text {
        writing-mode: horizontal-tb !important;
        transform: none !important;
        letter-spacing: 1px;
        font-size: 0.9rem;
    }
}

/* src/styles/base/responsive.css */

/* --- 1. GLOBAL DENSITY SCALING (The "De-Clutter") --- */
@media (max-width: 768px) {
    html {
        /* 
           Standard Desktop is usually 16px. 
           Setting this to 11px scales the ENTIRE UI down by ~30%.
           This makes it feel like a native app rather than a zoomed-in website.
        */
        font-size: 10px; 
    }

    /* --- TYPOGRAPHY CLAMPING --- */
    h1, .location-text h1, .banner-title, .profile-name, .docs-h1 {
        font-size: 1.6rem !important; /* Cap headers at ~17px visual size */
        line-height: 1.2;
        margin-bottom: 0.5rem !important;
    }
    
    h2, .action-box h3, .location-text h2, .docs-h2 {
        font-size: 1.2rem !important;
        margin-bottom: 0.5rem !important;
    }

    h3, .option-button h3, .card-text h3 {
        font-size: 1.1rem !important;
        margin-bottom: 0.2rem !important;
    }

    p, .storylet-text, .item-desc, .option-button p {
        line-height: 1.5 !important; /* Tighten line height for reading on small screens */
    }

    /* --- COMPONENT COMPACTING --- */
    
    /* Tighter containers */
    .container, 
    .storylet-container, 
    .main-content-wrapper,
    .admin-content-wrapper,
    .dashboard-content,
    .layout-main-grid {
        padding: 1rem !important; /* Reduce from 2rem+ */
        width: 100% !important;
        max-width: 100vw !important;
        box-sizing: border-box !important;
    }

    /* Reduce the massive whitespace in Storylets */
    .storylet-main-content {
        gap: 1rem !important;
        margin-bottom: 1rem !important;
        flex-direction: column;
    }

    /* Smaller, tighter Option buttons */
    .option-button {
        padding: 0.75rem 1rem !important; /* Was 1.5rem */
        min-height: auto !important;
        margin-bottom: 0.75rem !important;
    }

    .option-content-wrapper {
        padding: 0 !important; /* Remove inner wrapper padding */
        gap: 0.75rem !important;
        align-items: center;
        flex-direction: row !important; /* Keep image left of text if possible */
        text-align: left !important;
    }

    /* Compact Image Thumbnails in Options */
    .option-image-container {
        width: 50px !important;
        flex-shrink: 0;
        margin: 0 !important;
    }

    /* Tighter Action/Time Box */
    .action-box {
        padding: 0.5rem !important;
        margin-bottom: 0.5rem !important;
    }
    
    .action-timer {
        font-size: 0.9rem !important;
    }

    /* Tighter Inventory Items */
    .inventory-item {
        padding: 0.5rem !important;
    }
    
    .inventory-grid {
        gap: 0.5rem !important;
        grid-template-columns: 1fr !important; /* Force list view on mobile for space */
    }

    /* Compact Banners */
    .layout-banner, .location-wrapper.mode-banner {
        height: 140px !important; /* Drastically reduce banner height */
        min-height: 0 !important;
    }
    
    .banner-content {
        padding: 1rem !important;
        align-items: flex-end !important;
        flex-direction: row !important;
    }
    
    .banner-top-controls {
        top: 0.5rem;
        right: 0.5rem;
    }
    
    /* Make the switch character button tiny */
    .switch-char-btn-transparent {
        padding: 0.25rem 0.5rem !important;
        font-size: 0.7rem !important;
    }
}

/* --- 2. TABLET/MOBILE LAYOUT LOGIC (Max 1024px) --- */
@media (max-width: 1024px) {
    
    /* Collapse Grids */
    .layout-grid-nexus,
    .layout-grid-tabletop,
    .london-layout-container .layout-main-grid {
        display: flex !important;
        flex-direction: column;
        height: auto !important;
        overflow: visible !important;
        grid-template-columns: 1fr !important;
    }

    /* Reset Content Areas to flow naturally */
    .content-area, 
    .layout-content-col,
    .elysium-content {
        overflow: visible !important;
        height: auto !important;
        flex: 1 1 auto;
        padding: 0 !important;
    }

    /* Fix Tabletop Visuals */
    .tabletop-visual-col {
        height: 180px !important; /* Shorter visual area */
        width: 100%;
        order: -1; /* Always on top */
    }

    /* --- THE DRAWER SIDEBAR (Fixing "In-Your-Face") --- */
    
    /* 1. Hide by default */
    .sidebar-panel, .elysium-sidebar {
        display: none !important;
        
        /* Fixed positioning */
        position: fixed !important;
        top: 0; left: 0; bottom: 0;
        z-index: 2000 !important;
        
        /* DRAWER STYLING */
        width: 85vw !important; /* Leave a gap on the right */
        max-width: 300px !important; /* Never get too wide */
        
        background-color: var(--bg-panel) !important;
        box-shadow: 10px 0 50px rgba(0,0,0,0.5) !important; /* Deep shadow */
        border-right: 1px solid var(--border-color);
        
        overflow-y: auto !important;
        padding: 0 !important;
        margin: 0 !important;
        transform: none !important; /* Reset any theme rotations */
    }

    /* 2. Show when active */
    .sidebar-panel.mobile-visible, .elysium-sidebar.mobile-visible {
        display: flex !important;
        flex-direction: column;
        animation: slideIn 0.2s ease-out;
    }

    /* 3. The Close Button - Positioned nicely inside the drawer */
    .mobile-close-btn {
        display: block !important;
        width: 100%;
        text-align: left;
        background: var(--bg-item);
        border: none;
        border-bottom: 1px solid var(--border-color);
        padding: 1rem !important;
        color: var(--text-muted);
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.8rem;
        cursor: pointer;
    }
    
    /* 4. Sidebar Content Tweaks */
    .sidebar-content-scroll {
        padding: 1rem !important;
    }

    /* --- MOBILE FAB (Floating Action Button) --- */
    .mobile-sidebar-toggle {
        display: flex !important;
        align-items: center;
        justify-content: center;
        
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        z-index: 1500;
        
        background-color: var(--accent-highlight);
        color: var(--bg-main); /* High contrast text */
        
        border: 2px solid rgba(255,255,255,0.2);
        border-radius: 50px;
        
        padding: 0.8rem 1.2rem;
        font-weight: 800;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        backdrop-filter: blur(4px);
    }
}

/* Animation for the drawer */
@keyframes slideIn {
    from { transform: translateX(-100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

/* --- ADMIN SPECIFIC MOBILE FIXES --- */
@media (max-width: 900px) {
    .admin-layout { flex-direction: column; height: auto; }
    .admin-sidebar { 
        position: relative !important; 
        width: 100% !important; 
        height: auto !important; 
        flex-direction: row; 
        overflow-x: auto; 
        box-shadow: none;
        border-bottom: 1px solid var(--tool-border);
    }
    .admin-nav ul { flex-direction: row !important; }
    .admin-link { width: auto !important; border-bottom: none !important; white-space: nowrap; }
    
    .form-row { flex-direction: column; gap: 0.5rem; }
}