@keyframes glitch {
  0% { text-shadow: 0.05em 0 0 #00fffa, -0.05em 0 0 #ff0055; }
  14% { text-shadow: 0.05em 0 0 #00fffa, -0.05em 0 0 #ff0055; }
  15% { text-shadow: -0.05em -0.025em 0 #00fffa, 0.025em 0.025em 0 #ff0055; }
  49% { text-shadow: -0.05em -0.025em 0 #00fffa, 0.025em 0.025em 0 #ff0055; }
  50% { text-shadow: 0.025em 0.05em 0 #00fffa, 0.05em 0 0 #ff0055; }
  99% { text-shadow: 0.025em 0.05em 0 #00fffa, 0.05em 0 0 #ff0055; }
  100% { text-shadow: -0.025em 0 0 #00fffa, -0.05em -0.025em 0 #ff0055; }
}

@keyframes cyberpunk-pulse {
  0%, 100% { opacity: 0.7; filter: drop-shadow(0 0 3px var(--accent-highlight)); }
  50% { opacity: 1; filter: drop-shadow(0 0 8px var(--accent-highlight)); }
}

@keyframes scroll-scanlines {
  from { background-position-y: 0; }
  to { background-position-y: 200px; } /* Animate the background position instead of the whole element */
}

@keyframes film-grain-flicker {
  0% { opacity: 0.08; }
  25% { opacity: 0.12; }
  50% { opacity: 0.07; }
  75% { opacity: 0.14; }
  100% { opacity: 0.09; }
}

@keyframes synthwave-scroll {
  from { background-position: 0 0; }
  to { background-position: 0 200px; } /* Scrolls the grid vertically */
}

@keyframes drift-particles {
  from { transform: translateX(0px) translateY(0px); }
  to { transform: translateX(-50px) translateY(-100px); }
}

@keyframes drift-particles-2 {
  from { transform: translateX(0px) translateY(0px); }
  to { transform: translateX(70px) translateY(-80px); }
}

[data-theme='neo-tokyo']::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    
    /* Create the grid with two repeating gradients */
    background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, var(--accent-primary) 3px, var(--accent-primary) 4px),
        repeating-linear-gradient(90deg, transparent, transparent 2px, var(--accent-primary) 3px, var(--accent-primary) 4px);
    background-size: 50px 50px;
    
    opacity: 0.5;
    z-index: -1; /* Place it behind the content */
    
    /* The 3D effect */
    perspective: 300px;
    transform: rotateX(60deg) translateY(25%);
    
    /* The animation */
    animation: synthwave-scroll 4s linear infinite;
}

body[data-theme='witch-folk']::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background: url('/themes/witch-folk/noise.png'); /* You'll need a subtle noise/grain texture image */
    opacity: 0.1;
    pointer-events: none; /* Allows clicks to pass through */
    z-index: -1;
}


/* --- THEME DEFINITIONS --- */
:root {
    /* DEFAULT (DARK IDE) THEME */
    --bg-main: #282c34;
    --bg-panel: #1e2127;
    --bg-item: #3e4451;
    --bg-item-hover: #525968;
    
    --border-color: #444;
    --border-light: #555;
    
    --text-primary: #abb2bf;
    --text-secondary: #8f96a3;
    --text-muted: #5c6370;
    
    --accent-primary: #2a3e5c;
    --accent-hover: #3e5a8a;
    --accent-highlight: #61afef; /* Blue */
    
    --success-color: #98c379; /* Green */
    --danger-color: #e06c75; /* Red */
    
    --progress-bg: #2c3e50;
    --progress-fill: #3498db;
    
    --font-main: var(--font-inter), -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; /* Using Inter as a modern default */
    --border-radius: 8px;
}

/* --- THEME 1: VICTORIAN (Fallen London) --- */
[data-theme='victorian'] {
    --bg-main: #0b0f0b url('/themes/victorian/bg.png');
    --bg-panel: #131814;
    --bg-item: #1f2621;
    --bg-item-hover: #2a332c;
    --border-color: #3d4c42;
    --border-light: #526358;
    --text-primary: #e3dccb;
    --text-secondary: #a8b5ad;
    --text-muted: #6b7d72;
    --accent-primary: #4a381f; /* Deeper brass */
    --accent-hover: #634f2d;
    --accent-highlight: #b89a56; /* Tarnished Gold/Brass */
    --success-color: #b89a56;
    --danger-color: #8a3b3b;
    --progress-bg: #1f2621;
    --progress-fill: #b89a56;
    --font-main: var(--font-im-fell), "Times New Roman", serif;
    --border-radius: 2px;
}

[data-theme='terminal'] .text-class { /* Example selector */
   text-shadow: 0 0 3px rgba(51, 255, 0, 0.4);
}
/* --- THEME 2: TERMINAL (Sci-Fi) --- */
[data-theme='terminal'] {
    --bg-main: #000000;
    --bg-panel: #0a0a0a;
    --bg-item: #111;
    --bg-item-hover: #222;
    
    --border-color: #33ff00;
    --border-light: #008f11;
    
    --text-primary: #33ff00;
    --text-secondary: #00cc00;
    --text-muted: #006600;
    
    --accent-primary: #003300;
    --accent-hover: #004400;
    --accent-highlight: #33ff00;
    
    --success-color: #33ff00;
    --danger-color: #ff0000;
    
    --progress-bg: #111;
    --progress-fill: #33ff00;
    
    --font-main: var(--font-jetbrains), monospace;
    --border-radius: 0px;
}

/* --- THEME 3: PARCHMENT (Fantasy / D&D) --- */
[data-theme='parchment'] {
    --bg-main: #f4e4bc url('/themes/parchment/bg.jpg');
    --bg-panel: rgba(253, 246, 227, 0.8); /* Translucent paper */
    --bg-item: rgba(230, 220, 190, 0.6);
    --bg-item-hover: rgba(210, 200, 170, 0.8);
    
    --border-color: #8d6e63; /* Brown */
    --border-light: #a1887f;
    
    --text-primary: #3e2723; /* Dark Brown Ink */
    --text-secondary: #5d4037;
    --text-muted: #795548;
    
    --accent-primary: #795548;
    --accent-hover: #5d4037;
    --accent-highlight: #8d2d2d; /* Wax Seal Red */
    
    --success-color: #2e7d32; /* Forest Green */
    --danger-color: #c62828; /* Blood Red */
    
    --progress-bg: #d7ccc8;
    --progress-fill: #8d2d2d;
    
    --font-main: var(--font-garamond), "Georgia", serif;
    --border-radius: 3px;
}

/* --- THEME 4: NOIR (Detective) --- */
[data-theme='noir'] {
    --bg-main: #1a1a1a;
    --bg-panel: #222222;
    --bg-item: #333333;
    --bg-item-hover: #444444;
    --border-color: #555555;
    --border-light: #666666;
    --text-primary: #e0e0e0;
    --text-secondary: #aaaaaa;
    --text-muted: #777777;
    --accent-primary: #616161;
    --accent-hover: #757575;
    --accent-highlight: #d9a404; /* Moodier Amber */
    --success-color: #cccccc;
    --danger-color: #ef5350;
    --progress-bg: #424242;
    --progress-fill: #d9a404;
    --font-main: var(--font-special-elite), monospace;
    --border-radius: 2px; /* Sharper corners */
}

/* --- CYBERPUNK --- */
[data-theme='cyberpunk'] {
    --bg-main: #0d1117;
    --bg-panel: rgba(22, 27, 34, 0.8);
    --bg-item: #161b22;
    --bg-item-hover: #21262d;

    --border-color: #30363d;
    --border-light: #8b949e;

    --text-primary: #e6f1ff;
    --text-secondary: #8892b0;
    --text-muted: #484f58;

    --accent-primary: #238636;
    --accent-hover: #2ea043;
    --accent-highlight: #ff64c4; /* Magenta */

    --success-color: #238636; /* GitHub Green */
    --success-bg: rgba(35, 134, 54, 0.15);

    --danger-color: #da3633; /* GitHub Red */
    --danger-bg: rgba(218, 54, 51, 0.15);

    --progress-bg: #161b22;
    --progress-fill: #1f6feb; /* GitHub Blue */

    --font-main: var(--font-fira-code), "Roboto Mono", monospace;
    --border-radius: 6px;
}

/* --- DARK FANTASY (HORROR) --- */
[data-theme='dark-fantasy'] {
    --bg-main: #121010;
    --bg-panel: #1a1818;
    --bg-item: #2a2828;
    --bg-item-hover: #3a3838;

    --border-color: #4a4444;
    --border-light: #6b6666;

    --text-primary: #a39e9e;
    --text-secondary: #7a7575;
    --text-muted: #5b5858;

    --accent-primary: #3a2e2e;
    --accent-hover: #5c4848;
    --accent-highlight: #b42020; /* Blood Red */

    --success-color: #8c9d8c; /* Faded Green */
    --success-bg: rgba(140, 157, 140, 0.1);

    --danger-color: #b42020;
    --danger-bg: rgba(180, 32, 32, 0.1);

    --progress-bg: #2a2828;
    --progress-fill: #8c9d8c;

    --font-main: var(--font-crimson-text), var(--font-im-fell), serif;
    --border-radius: 2px;
}

/* --- PIRATE (NAUTICAL) --- */
[data-theme='pirate'] {
    --bg-main: #3a2e22 url('/themes/pirate/wood-plank.png'); /* Dark wood bg */
    --bg-panel: #fdf6e3; /* Parchment panel */
    --bg-item: #e8dcc4;
    --bg-item-hover: #d2c3a9;
    --border-color: #8d6e63; /* Rope/leather color */
    --border-light: #a1887f;
    --text-primary: #4e342e; /* Dark ink on parchment */
    --text-secondary: #6d4c41;
    --text-muted: #795548;
    --accent-primary: #795548;
    --accent-hover: #5d4037;
    --accent-highlight: #d9a025; /* Gold Coin */
    --success-color: #2e7d32; /* Emerald/Jungle green */
    --danger-color: #b71c1c; /* Blood red */
    --progress-bg: #d7ccc8;
    --progress-fill: #d9a025;
    --font-main: var(--font-pirata), serif;
    --border-radius: 3px;
}

[data-theme='solarpunk'] {
    --bg-main: #f0f7e9; 
    --bg-panel: #ffffff;
    --bg-item: #e7f2dd;
    --bg-item-hover: #d9eccc;

    --border-color: #b5c9a9;
    --border-light: #cfe1c2;

    --text-primary: #355834;
    --text-secondary: #4a7550;
    --text-muted: #7b9a78;

    --accent-primary: #6bbb8a;      /* Leaf green */
    --accent-hover: #5aa674;
    --accent-highlight: #ffb347;    /* Solar orange */

    --success-color: #6bbb8a;
    --danger-color: #d65555;

    --progress-bg: #d9eccc;
    --progress-fill: #6bbb8a;

    --font-main: var(--font-inter), "Segoe UI", sans-serif;
    --border-radius: 10px;
}

[data-theme='lab'] {
    --bg-main: #e5ecef;
    --bg-panel: #f8fbfc;
    --bg-item: #e2e8ea;
    --bg-item-hover: #d5dfe2;

    --border-color: #b8c3c7;
    --border-light: #d0dadf;

    --text-primary: #1a2428;
    --text-secondary: #43525a;
    --text-muted: #7c8a90;

    --accent-primary: #1db7d5;      /* Cyan tech */
    --accent-hover: #199eb7;
    --accent-highlight: #00e5ff;

    --success-color: #28a745;
    --danger-color: #d9534f;

    --progress-bg: #cfd8dc;
    --progress-fill: #1db7d5;

    --font-main: var(--font-inter), "Segoe UI", sans-serif;
    --border-radius: 6px;
}

[data-theme='druidic'] {
    --bg-main: #0e1a12;
    --bg-panel: #14251a;
    --bg-item: #1c3a28;
    --bg-item-hover: #254c35;

    --border-color: #3d5f47;
    --border-light: #527c5e;

    --text-primary: #d2eada;
    --text-secondary: #9dbfad;
    --text-muted: #6e8b7a;

    --accent-primary: #3f7f59;
    --accent-hover: #519f73;
    --accent-highlight: #b8ff66; /* Bioluminescent green */

    --success-color: #7ed957;
    --danger-color: #c0392b;

    --progress-bg: #1c3a28;
    --progress-fill: #3f7f59;

    --font-main: var(--font-uncial), var(--font-im-fell), serif; /* Uncial is perfect for this */
    --border-radius: 3px;
}

[data-theme='neo-tokyo'] {
    --bg-main: #060013;
    --bg-panel: #240046;
    --bg-item: #32006b;
    --bg-item-hover: #400080;

    --border-color: #8234c9;
    --border-light: #b875ff;

    --text-primary: #f0d4ff;
    --text-secondary: #bfa3d9;
    --text-muted: #8669a6;

    --accent-primary: #ff5ea6;     /* Neon pink */
    --accent-hover: #ff7ec4;
    --accent-highlight: #42e7ff;   /* Cyan neon */

    --success-color: #42e7aa;
    --danger-color: #ff467d;

    --progress-bg: #32006b;
    --progress-fill: #ff5ea6;

    --font-main: var(--font-montserrat), sans-serif;
    --border-radius: 6px;
}

[data-theme='gothic'] {
    --bg-main: #0c0d0f;
    --bg-panel: #16181b;
    --bg-item: #1f2125;
    --bg-item-hover: #2a2d33;
    --border-color: #4a0e1c; /* Deep wine/blood border */
    --border-light: #6c2333;
    --text-primary: #d5d2cd;
    --text-secondary: #a8a4a0;
    --text-muted: #777572;
    --accent-primary: #4b1a1a;
    --accent-hover: #6a2525;
    --accent-highlight: #b32a2a; /* Blood crimson */
    --success-color: #7da27d;
    --danger-color: #b32a2a;
    --progress-bg: #1f2125;
    --progress-fill: #b32a2a;
    --font-main: var(--font-grenze), serif; /* CHANGED */
    --border-radius: 0px; /* Sharp, architectural corners */
}

[data-theme='western'] {
    --bg-main: #4b3621; /* Dark wood, like a bar */
    --bg-panel: #fff8ef; /* Lighter, like a wanted poster */
    --bg-item: #e7d3bb;
    --bg-item-hover: #d8bea0;
    --border-color: #b08968;
    --border-light: #d4a276;
    --text-primary: #3a291b; /* Dark text on light panel */
    --text-secondary: #5b442f;
    --text-muted: #7a634d;
    --accent-primary: #8c4f2b; /* Leather */
    --accent-hover: #a06339;
    --accent-highlight: #4691d9; /* Denim blue */
    --progress-bg: #d8bea0;
    --progress-fill: #8c4f2b;
    --font-main: var(--font-roboto-slab), serif;
    --border-radius: 3px;
}

[data-theme='grimdark-sci-fi'] {
    --bg-main: #0a0d0f;
    --bg-panel: #101418;
    --bg-item: #171c21;
    --bg-item-hover: #1f262d;

    --border-color: #2a3036;
    --border-light: #3a424a;

    --text-primary: #c9d2d8;
    --text-secondary: #88949c;
    --text-muted: #586168;

    --accent-primary: #24424f;
    --accent-hover: #2e5968;
    --accent-highlight: #53c0da; /* cold cyan */

    --success-color: #7bb39e; /* pale green */
    --danger-color: #b66363; /* desaturated blood red */

    --progress-bg: #171c21;
    --progress-fill: #53c0da;

    --font-main: var(--font-orbitron), sans-serif;
    --border-radius: 2px;
}

[data-theme='jrpg-bright'] {
    --bg-main: #f0f6ff;
    --bg-panel: #ffffff;
    --bg-item: #e7f0ff;
    --bg-item-hover: #d8e7ff;

    --border-color: #aac6ff;
    --border-light: #c7dbff;

    --text-primary: #1c2d5a;
    --text-secondary: #425a93;
    --text-muted: #788ab3;

    --accent-primary: #3a72ff;
    --accent-hover: #1d5aff;
    --accent-highlight: #ffca3a; /* JRPG gold */

    --success-color: #2ecc71;
    --danger-color: #e74c3c;

    --progress-bg: #d8e7ff;
    --progress-fill: #3a72ff;

    --font-main: var(--font-nunito), "Helvetica", sans-serif;
    --border-radius: 10px;
}

[data-theme='abyssal'] {
    --bg-main: #040d14;
    --bg-panel: #07141f;
    --bg-item: #0a1c28;
    --bg-item-hover: #0f2534;

    --border-color: #123047;
    --border-light: #1f4b6d;

    --text-primary: #c3eaff;
    --text-secondary: #88b8d4;
    --text-muted: #4e6f84;

    --accent-primary: #0c425c;
    --accent-hover: #145c80;
    --accent-highlight: #27f2da; /* bioluminescent teal */

    --success-color: #27f2da;
    --danger-color: #ff4f67;

    --progress-bg: #0a1c28;
    --progress-fill: #27f2da;

    --font-main: var(--font-inter), sans-serif;
    --border-radius: 4px;
}
[data-theme='arcanotech'] .panel-class { /* Example selector */
    box-shadow: 0 0 8px rgba(141, 216, 255, 0.2); /* Uses --accent-highlight color */
}

[data-theme='arcanotech'] {
    --bg-main: #0c0e14;
    --bg-panel: #141722;
    --bg-item: #1c2230;
    --bg-item-hover: #252d3f;

    --border-color: #394b66;
    --border-light: #52688a;

    --text-primary: #d5e6ff;
    --text-secondary: #9fb7d6;
    --text-muted: #6f7f99;

    --accent-primary: #2e4aa8;
    --accent-hover: #3c60d4;
    --accent-highlight: #8dd8ff; /* mana glow */
    --accent-highlight-rgb: 141, 216, 255; /* NEW: RGB version for box-shadow */

    --success-color: #7ecfff;
    --danger-color: #db5e7e;

    --progress-bg: #1c2230;
    --progress-fill: #8dd8ff;

    --font-main: var(--font-cinzel), serif;
    --border-radius: 3px;
}

[data-theme='terminal-amber'] {
    --bg-main: #000000;
    --bg-panel: #0a0a00;
    --bg-item: #111100;
    --bg-item-hover: #222200;

    --border-color: #ffb000;
    --border-light: #ffcc33;

    --text-primary: #ffcc66;
    --text-secondary: #ffb84d;
    --text-muted: #996600;

    --accent-primary: #664400;
    --accent-hover: #886600;
    --accent-highlight: #ffdd88;

    --success-color: #ffee99;
    --danger-color: #ff5500;

    --progress-bg: #111100;
    --progress-fill: #ffcc66;

    --font-main: var(--font-jetbrains), "Courier New", monospace;
    --border-radius: 0;
}

[data-theme='arabesque'] {
    --bg-main: #f0e8d8;
    --bg-panel: #faf4e6;
    --bg-item: #efe3c9;
    --bg-item-hover: #e2d2b0;

    --border-color: #c8a97e;
    --border-light: #e0c9a1;

    --text-primary: #5a3b1e;
    --text-secondary: #7a5632;
    --text-muted: #9c7a52;

    --accent-primary: #a67c36;
    --accent-hover: #c29448;
    --accent-highlight: #e8c15c; /* bright desert gold */

    --success-color: #3f8d6b;
    --danger-color: #a33f3f;

    --progress-bg: #e2d2b0;
    --progress-fill: #e8c15c;

    --font-main: var(--font-cormorant), serif;
    --border-radius: 6px;
}

[data-theme='art-deco'] {
    --bg-main: #111111;
    --bg-panel: #1a1a1a;
    --bg-item: #222222;
    --bg-item-hover: #2a2a2a;
    --border-color: #bfa76f; /* Strong gold border */
    --border-light: #e6d8a5;
    --text-primary: #f5ecd7;
    --text-secondary: #c7b999;
    --text-muted: #8f846c;
    --accent-primary: #a88949;
    --accent-hover: #c2a35b;
    --accent-highlight: #f5d88a; /* Shimmering gold */
    --success-color: #d5c48b;
    --danger-color: #d66f6f;
    --progress-bg: #222222;
    --progress-fill: #f5d88a;
    --font-main: var(--font-righteous), sans-serif; /* CHANGED */
    --border-radius: 0;
}

[data-theme='steampunk'] {
    --bg-main: #2c231a;
    --bg-panel: #3b2f23;
    --bg-item: #4a3b2c;
    --bg-item-hover: #5a4a36;

    --border-color: #8f6a42;
    --border-light: #c49a6c;

    --text-primary: #f1e4c7;
    --text-secondary: #d2c1a4;
    --text-muted: #a59072;

    --accent-primary: #704b2d;
    --accent-hover: #8d603a;
    --accent-highlight: #e3b56f; /* brass */

    --success-color: #7ebf78;
    --danger-color: #b75a4a;

    --progress-bg: #4a3b2c;
    --progress-fill: #e3b56f;

    --font-main: var(--font-im-fell), var(--font-garamond), serif;
    --border-radius: 2px;
}

[data-theme='candy'] {
    --bg-main: #fff7fc;
    --bg-panel: #ffffff;
    --bg-item: #fdeaff;
    --bg-item-hover: #fbd6ff;

    --border-color: #ffb7f5;
    --border-light: #ffd1fa;

    --text-primary: #66336b;
    --text-secondary: #8f4a96;
    --text-muted: #b66ebf;

    --accent-primary: #ff6ad5; /* bubblegum pink */
    --accent-hover: #ff82dd;
    --accent-highlight: #6ae2ff; /* cotton-candy blue */

    --success-color: #8be379;
    --danger-color: #ff6b6b;

    --progress-bg: #fdeaff;
    --progress-fill: #ff6ad5;

    --font-main: var(--font-poppins), var(--font-comic-neue), sans-serif;
    --border-radius: 12px;
}

[data-theme='stone-dwarven'] {
    --bg-main: #1c1c1c url('/themes/dwarf/stone-texture.png'); /* Add a subtle stone bg texture */
    --bg-panel: #242424;
    --bg-item: #2f2f2f;
    --bg-item-hover: #3a3a3a;
    --border-color: #595959;
    --border-light: #7a7a7a;
    --text-primary: #e0d9cf;
    --text-secondary: #b3aba1;
    --text-muted: #7d766e;
    --accent-primary: #8a5529; /* copper */
    --accent-hover: #a96c36;
    --accent-highlight: #ff9a3c; /* molten orange */
    --success-color: #8fbf6e;
    --danger-color: #c16666;
    --progress-bg: #2f2f2f;
    --progress-fill: #ff9a3c;
    --font-main: var(--font-roboto-slab), var(--font-cinzel), serif;
    --border-radius: 1px;

    /* NEW: Variables for the shadow effect */
    --shadow-dark: #111;
    --shadow-light: #444;
}

[data-theme='classic-scifi'] {
    --bg-main: #e7ebee;
    --bg-panel: #f8fafc;
    --bg-item: #d8dce0;
    --bg-item-hover: #c9cdd2;

    --border-color: #9aa0a6;
    --border-light: #c5c9ce;

    --text-primary: #1d242b;
    --text-secondary: #3b4753;
    --text-muted: #6a7885;

    --accent-primary: #ff6b00; /* NASA orange */
    --accent-hover: #cc5600;
    --accent-highlight: #007bff; /* Bright CRT blue */

    --success-color: #2e8b57;
    --danger-color: #b22222;

    --progress-bg: #cfd4d8;
    --progress-fill: #007bff;

    --font-main: var(--font-orbitron), sans-serif;
    --border-radius: 4px;
}

[data-theme='revolutionary'] {
    --bg-main: #f2eadd; /* Aged, slightly rough paper */
    --bg-panel: #fbf5ef;
    --bg-item: #e9e0d4;
    --bg-item-hover: #dcd0bf;

    --border-color: #7a5e47;
    --border-light: #9c836b;

    --text-primary: #1e1a17; /* Stark, almost black ink */
    --text-secondary: #4a3a32;
    --text-muted: #6f5b4e;

    /* THE NEW TRICOLOR PALETTE */
    --accent-primary: #9d2323;   /* A deeper, richer Revolution Red */
    --accent-secondary: #2a3d64; /* Revolutionary Blue */
    --accent-highlight: #c7a448; /* Gilded/Mustard Yellow */

    --accent-hover: #7b1c1c;
    --success-color: #386641;
    --danger-color: #9d2323; /* Danger is now the primary red */

    --progress-bg: #ddd2be;
    --progress-fill: var(--accent-secondary); /* Use blue for progress */

    --font-main: var(--font-roboto-slab), serif;
    --border-radius: 0px;
}

[data-theme='solar'] {
    --bg-main: linear-gradient(180deg, #0b0f28, #142f52 40%, #175b6b);
    --bg-panel: rgba(255, 255, 255, 0.12);
    --bg-item: rgba(255, 255, 255, 0.08);
    --bg-item-hover: rgba(255, 255, 255, 0.16);

    --border-color: #7bd3ff;
    --border-light: #a3e9ff;

    --text-primary: #dff6ff;
    --text-secondary: #8bc5d3;
    --text-muted: #5e8b99;

    --accent-primary: #7ee8fa; /* glowing aqua */
    --accent-hover: #63d1df;
    --accent-highlight: #ffe084; /* sunlight gold */

    --success-color: #7cf2aa;
    --danger-color: #ff6e6e;

    --progress-bg: rgba(255,255,255,0.15);
    --progress-fill: #7ee8fa;

    --font-main: var(--font-inter), sans-serif;
    --border-radius: 10px;
}

[data-theme='occult-academic'] {
    --bg-main: #1a1318;
    --bg-panel: #231a22;
    --bg-item: #2f242d;
    --bg-item-hover: #3b2f39;

    --border-color: #775c69;
    --border-light: #9d8290;

    --text-primary: #e9dfe7;
    --text-secondary: #c5b4c1;
    --text-muted: #8f7b8a;

    --accent-primary: #8c3d65; /* wine */
    --accent-hover: #a3507c;
    --accent-highlight: #d2a86e; /* brass */

    --success-color: #7da87b;
    --danger-color: #b34a5a;

    --progress-bg: #3b2f39;
    --progress-fill: #a3507c;

    --font-main: var(--font-merriweather), serif;
    --border-radius: 3px;
}

[data-theme='renaissance'] {
    --bg-main: #f7f3ec;
    --bg-panel: #fffdf8;
    --bg-item: #efe8da;
    --bg-item-hover: #e2d9c7;

    --border-color: #b89b6c; /* gold/burnished bronze */
    --border-light: #d4c19a;

    --text-primary: #3d2c1e;
    --text-secondary: #5c4733;
    --text-muted: #85715a;

    --accent-primary: #1d3b78; /* lapis */
    --accent-hover: #254c99;
    --accent-highlight: #c19a4c; /* gold leaf */

    --success-color: #3c7a4a;
    --danger-color: #a63d40;

    --progress-bg: #d9cfbd;
    --progress-fill: #c19a4c;

    --font-main: var(--font-garamond), serif;
    --border-radius: 3px;
}

[data-theme='ink-brass'] {
    --bg-main: #111416;
    --bg-panel: #1a1e21;
    --bg-item: #22272a;
    --bg-item-hover: #2e353a;

    --border-color: #6a5640; /* brass */
    --border-light: #8b7558;

    --text-primary: #dcd2c4;
    --text-secondary: #b5a897;
    --text-muted: #7a7065;

    --accent-primary: #8b5e34; /* tarnished copper */
    --accent-hover: #a67645;
    --accent-highlight: #cba268; /* polished brass */

    --success-color: #5c8f65;
    --danger-color: #b34539;

    --progress-bg: #2f363a;
    --progress-fill: #cba268;

    --font-main: var(--font-roboto-slab), serif;
    --border-radius: 2px;
}

[data-theme='ukiyoe'] {
    --bg-main: #f5f2e9; /* rice paper */
    --bg-panel: #faf7f0;
    --bg-item: #e7e1d1;
    --bg-item-hover: #dcd5c2;
    --border-color: #7a6a5b; /* warm wood */
    --border-light: #9b8a77;
    --text-primary: #2c1f17; /* sumi ink */
    --text-secondary: #4a3a2e;
    --text-muted: #6d5a4a;
    --accent-primary: #3a5a78; /* indigo */
    --accent-hover: #50749c;
    --accent-highlight: #c33f3f; /* vermillion */
    --success-color: #3d7a4e;
    --danger-color: #a63a3a;
    --progress-bg: #d6cec0;
    --progress-fill: #3a5a78;
    --font-main: var(--font-noto-serif-jp), serif;
    --border-radius: 0px;
}

[data-theme='imperial-rome'] {
    --bg-main: #f2eee9; /* marble */
    --bg-panel: #fbf9f6;
    --bg-item: #e7e1db;
    --bg-item-hover: #d8d1c9;

    --border-color: #8b6b47;
    --border-light: #b19063;

    --text-primary: #4c3f32; /* Make base text a bit darker to help the shadow pop */
    --text-secondary: #4c3f32;
    --text-muted: #7b6a57;

    --accent-primary: #6a1f58; /* imperial purple */
    --accent-hover: #8a2c73;
    --accent-highlight: #c89e3f; /* gold */

    --success-color: #4c7c44; /* laurel green */
    --danger-color: #992e2e; /* roman red */

    --progress-bg: #d7cec5;
    --progress-fill: #c89e3f;

    --font-main: var(--font-cinzel), var(--font-garamond), serif;
    --border-radius: 2px;
}

[data-theme='corpocracy'] {
    /* NEW: A subtle, dark background makes the glass effect pop */
    --bg-main: #0e0d16 url('/themes/corp/grid-bg.png');
    --bg-panel: rgba(200, 205, 255, 0.08); /* Must be semi-transparent */
    --bg-item: rgba(200, 205, 255, 0.1);
    --bg-item-hover: rgba(200, 205, 255, 0.16);

    --border-color: #6f7aff;
    --border-light: #9fa6ff;
    --text-primary: #e5e8ff;
    --text-secondary: #b4b8e0;
    --text-muted: #7d80a8;
    --accent-primary: #7f5af0;
    --accent-hover: #956ef5;
    --accent-highlight: #23d9d1; /* neon cyan */
    --success-color: #45ffb0;
    --danger-color: #ff4e78;
    --progress-bg: rgba(255,255,255,0.12);
    --progress-fill: #23d9d1;
    --font-main: var(--font-inter), sans-serif;
    --border-radius: 8px; /* Slightly larger radius works well with glass */
}

[data-theme='witch-folk'] {
    /* UPDATED: The gradient from a mossy floor to a dark canopy */
    --bg-main: linear-gradient(to top, #2a2d25 0%, #1b1d17 100%);
    --bg-panel: #23251f;
    --bg-item: #2a2d25;
    --bg-item-hover: #35382f;

    --border-color: #5a5e4c;
    --border-light: #7e826c;
    --text-primary: #e0e2d9;
    --text-secondary: #b9bcae;
    --text-muted: #7f8376;
    --accent-primary: #6b2e2e; /* dried blood */
    --accent-hover: #853939;
    --accent-highlight: #a8b76c; /* pale moss */
    --success-color: #7c8f66;
    --danger-color: #8c3d3d;
    --progress-bg: #2a2d25;
    --progress-fill: #a8b76c;
    --font-main: var(--font-crimson-text), serif;
    --border-radius: 2px;
}

[data-theme='vaporwave'] {
    --bg-main: #241b2f;
    --bg-panel: #2e2440;
    --bg-item: #3b2f55;
    --bg-item-hover: #4c3b6c;

    --border-color: #ff77ff;
    --border-light: #ffc8ff;

    --text-primary: #ffeefe;
    --text-secondary: #d6bbff;
    --text-muted: #a38cc4;

    --accent-primary: #ff4ecb; /* neon pink */
    --accent-hover: #ff72d8;
    --accent-highlight: #72f6ff; /* aqua */

    --success-color: #89ffc4;
    --danger-color: #ff7e7e;

    --progress-bg: #4c3b6c;
    --progress-fill: #72f6ff;

    --font-main: var(--font-josefin), sans-serif;
    --border-radius: 6px;

    position: relative; /* Important for the overlay */
    overflow: hidden; /* Prevents scrollbars from the pseudo-element */
}

[data-theme='nordic'] {
    --bg-main: #0f1417;
    --bg-panel: #171d21;
    --bg-item: #1e262b;
    --bg-item-hover: #283238;

    --border-color: #445159;
    --border-light: #6a7983;

    --text-primary: #d7dde1;
    --text-secondary: #a9b3ba;
    --text-muted: #78848b;

    --accent-primary: #375c6c; /* fjord blue */
    --accent-hover: #447789;
    --accent-highlight: #c2a878; /* bronze */

    --success-color: #5f8d6a;
    --danger-color: #8d4e4e;

    --progress-bg: #1e262b;
    --progress-fill: #375c6c;

    --font-main: var(--font-crimson-text), serif;
    --border-radius: 3px;
}

[data-theme='frontier'] {
    --bg-main: #f0e4d2;
    --bg-panel: #fdf8f0;
    --bg-item: #e4d4b8;
    --bg-item-hover: #d6c4a4;

    --border-color: #8b6947;
    --border-light: #a88a67;

    --text-primary: #3a291b;
    --text-secondary: #5b442f;
    --text-muted: #7a634d;

    --accent-primary: #b05c2e; /* saddle leather */
    --accent-hover: #c9723d;
    --accent-highlight: #d4b26e; /* prairie gold */

    --success-color: #4b7d47;
    --danger-color: #923d2e;

    --progress-bg: #d1c0a5;
    --progress-fill: #b05c2e;

    --font-main: var(--font-roboto-slab), serif;
    --border-radius: 3px;
}

[data-theme='bayou'] {
    --bg-main: #0d120f;
    --bg-panel: #141a16;
    --bg-item: #1a221d;
    --bg-item-hover: #253029;

    --border-color: #506054;
    --border-light: #748778;

    --text-primary: #d6e1d7;
    --text-secondary: #b4c2b7;
    --text-muted: #87978d;

    --accent-primary: #4a6d52; /* marsh green */
    --accent-hover: #5e8a67;
    --accent-highlight: #7df0ff; /* eerie blue flame */

    --success-color: #76a97a;
    --danger-color: #9d4f43;

    --progress-bg: #1a221d;
    --progress-fill: #4a6d52;

    --font-main: var(--font-merriweather), serif;
    --border-radius: 2px;
}

/* --- GLOBAL STYLES --- */

body {
    background-color: var(--bg-main);
    color: var(--text-primary);
    font-family: var(--font-main);
    padding: 0; /* <--- Set to 0 */
    margin: 0;
}

.container {
    max-width: 800px;
    margin: 0 auto;
}

.storylet-container {
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    padding: 2rem;
    border-radius: var(--border-radius);
    max-width: 900;
}

.storylet-text {
    white-space: pre-wrap;
    line-height: 1.6;
    color: var(--text-secondary);
}

.options-container {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.option-button {
    background-color: var(--bg-item);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
    padding: 0;
    border-radius: var(--border-radius);
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s, border-color 0.2s;
    font-size: 1rem;
    font-family: var(--font-main);
}

.option-button:hover {
    background-color: var(--bg-item-hover);
    border-color: var(--accent-highlight);
}

.option-button h3 {
    margin: 0 0 0.5rem 0;
}

.option-button p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.quality-changes {
    margin-top: 1rem;
    padding: 1rem;
    background-color: var(--success-bg);
    border: 1px solid var(--success-color);
    border-radius: var(--border-radius);
}

.metatext {
    font-style: italic;
    color: var(--text-muted);
    border-left: 3px solid var(--border-light);
    padding-left: 1rem;
    margin-top: 1.5rem;
}

.option-short-desc {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: normal;
}

.footer-actions {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}

.return-button, .continue-button {
    width: 100%;
    text-align: center;
    background-color: var(--accent-primary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 1rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: bold;
}

.return-button:hover, .continue-button:hover {
    background-color: var(--accent-hover);
}

.option-button.locked {
    background-color: var(--bg-panel);
    cursor: not-allowed;
    opacity: 0.6;
    border-color: var(--border-color);
}

.option-button.locked:hover {
    background-color: var(--bg-panel);
}

.option-skill-check {
    margin: 0.75rem 0 0 0;
    font-size: 0.9rem;
    font-weight: bold;
}

.option-locked-reason {
    margin-top: 0.75rem;
    color: var(--danger-color);
    font-weight: bold;
    font-size: 0.85rem;
}

.option-meta-text {
    margin: 0.75rem 0 0 0;
    color: var(--accent-highlight);
    font-size: 0.85rem;
    font-weight: bold;
    border-top: 1px dashed var(--border-light);
    padding-top: 0.75rem;
}

.storylet-main-content {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
    margin-bottom: 2rem;
}

.storylet-image-container {
    flex-shrink: 0;
    width: 210px;
    position: relative;
}

.storylet-image {
    width: 100%;
    height: auto;
    display: block;
    border-radius: var(--border-radius);
    border: 1px solid var(--border-light);
    aspect-ratio: 3 / 4;
    object-fit: cover;
}

.storylet-text-content {
    flex-grow: 1;
}

.storylet-text-content h1 {
    margin-top: 0;
    color: var(--text-primary);
}

.result-title {
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    margin-bottom: 1rem;
    display: inline-block;
}

.result-title.success {
    background-color: var(--success-bg);
    border-left: 4px solid var(--success-color);
}

.result-title.failure {
    background-color: var(--danger-bg);
    border-left: 4px solid var(--danger-color);
}

.skill-check-result {
    margin-top: 1.5rem;
    padding: 1rem;
    background-color: var(--bg-main);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
    text-align: center;
    font-style: italic;
    color: var(--text-secondary);
}

.loading-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 400px;
    font-style: italic;
    color: var(--text-muted);
}

.option-content-wrapper {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem 1.5rem;
}

.option-image-container {
    flex-shrink: 0;
    width: 60px;
}

.option-image {
    width: 100%;
    display: block;
    aspect-ratio: 3 / 4;
    object-fit: cover;
    border-radius: calc(var(--border-radius) / 2);
    border: 1px solid var(--border-light);
}

.option-text-wrapper {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.option-text-wrapper > h3,
.option-text-wrapper > p {
    margin-top: 0;
}

.location-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
}

.location-image-container {
    flex-shrink: 0;
    width: 150px;
}

.location-image {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid var(--border-light);
}

.location-text h2 {
    margin: 0;
    font-size: 1rem;
    font-weight: normal;
    color: var(--text-muted);
}

.location-text h1 {
    margin: 0;
    font-size: 2.5rem;
    color: var(--text-primary);
}

/* --- OPPORTUNITY DECK --- */
.opportunity-hand {
    margin-top: 2rem;
}

.opportunity-hand h2 {
    font-size: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
}

.card-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
}

.card {
    background-color: var(--bg-item);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
    border-radius: var(--border-radius);
    text-align: left;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    overflow: hidden;
    padding: 0;
    display: flex;
    flex-direction: column;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    border-color: var(--accent-highlight);
}

.card-image {
    width: 100%;
    aspect-ratio: 3 / 2;
    object-fit: cover;
}

.card-text {
    padding: 1rem;
}

.card-text h3 {
    margin: 0 0 0.5rem 0;
}

.card-text p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-style: italic;
}

.no-cards-text {
    color: var(--text-muted);
    font-style: italic;
}

.deck-actions {
    margin-top: 2rem;
    text-align: center;
}

.deck-button {
    background-color: var(--accent-primary);
    color: var(--text-primary);
    border: none;
    padding: 1rem 2rem;
    border-radius: var(--border-radius);
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s;
}

.deck-button:hover {
    background-color: var(--accent-hover);
}

.location-storylets {
    margin-top: 2rem;
}

.location-storylets h2 {
    font-size: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
}

.storylet-list-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.quality-changes-container {
    margin-top: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    border-top: 1px solid var(--border-color);
    padding-top: 1.5rem;
}

.quality-change-item {
    width: 100%;
}

.quality-change-text {
    margin: 0 0 0.25rem 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.quality-bar-background {
    width: 100%;
    height: 12px;
    background-color: var(--progress-bg);
    border-radius: var(--border-radius);
    overflow: hidden;
    border: 1px solid var(--border-light);
}

.quality-bar-fill {
    height: 100%;
    background-color: var(--success-color);
    border-radius: var(--border-radius);
    transition: width 0.75s ease-in-out;
}

.quality-change-text.simple-change {
    padding: 0.5rem 0;
}

.bar-wrapper {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.bar-level-label {
    font-size: 0.8rem;
    font-weight: bold;
    color: var(--text-muted);
}

.quality-bar-background {
    flex-grow: 1; 
    height: 12px;
    background-color: var(--progress-bg);
    border-radius: var(--border-radius);
    overflow: hidden;
    border: 1px solid var(--border-light);
}

.quality-bar-fill.menace {
    background-color: var(--danger-color);
}

.simple-change.menace-text {
    color: var(--danger-color);
    font-weight: bold;
}

.main-content-column {
    width: 100%;
}

.sidebar-column {
    width: 280px;
}

.main-content-column > .storylet-container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
}

.hub-layout {
    display: grid;
    grid-template-columns: 280px minmax(0, 1fr) 280px; 
    gap: 2rem;
    align-items: flex-start;
    width: 100%;
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 2rem;
    box-sizing: border-box;
}

.character-sheet {
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    padding: 1.5rem;
    border-radius: var(--border-radius);
}

.character-sheet h2 {
    margin-top: 0;
    text-align: center;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 1rem;
    margin-bottom: 1.5rem;
}

.character-sheet ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.quality-name {
    font-weight: bold;
    color: var(--text-primary);
    font-size: 1.1rem; 
}

.quality-level {
    font-size: 1.1rem; 
    font-weight: bold;
    color: var(--accent-highlight);
}

.quality-cp-bar-background {
    height: 6px;
    width: 100%;
    background-color: var(--progress-bg);
    border-radius: 3px;
    border: 1px solid var(--border-light);
    overflow: hidden;
}

.quality-cp-bar-fill {
    height: 100%;
    background-color: var(--progress-fill);
    border-radius: 3px;
    transition: width 0.3s ease-out;
}

.equipment-slots {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
}

.equip-slot {
    background: var(--bg-panel);
    border: 1px solid var(--border-color);
    padding: 1rem;
    border-radius: var(--border-radius);
    width: 150px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.slot-label {
    font-size: 0.8rem;
    color: var(--text-muted);
    text-transform: uppercase;
    font-weight: bold;
}

.equipped-item {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.inventory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
}

.inventory-item {
    padding: 1rem;
    background: var(--bg-item);
    border: 1px solid var(--border-light);
    border-radius: var(--border-radius);
}

.item-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
}

.item-count {
    background: var(--bg-main);
    padding: 0.1rem 0.4rem;
    border-radius: 4px;
    font-size: 0.8rem;
}

.item-desc {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.item-bonus {
    font-size: 0.8rem;
    color: var(--success-text);
    font-style: italic;
    margin-bottom: 0.5rem;
}

.equip-btn, .unequip-btn {
    width: 100%;
    padding: 0.3rem;
    font-size: 0.9rem;
    cursor: pointer;
    border-radius: var(--border-radius);
}

.equip-btn {
    background: var(--accent-primary);
    color: var(--text-primary);
    border: none;
}

.unequip-btn {
    background: var(--danger-color);
    color: white;
    border: none;
}

/* --- ADMIN --- */
/* (Admin styles use standard colors as they are part of the platform, not the game) */
/* However, to keep it clean, we can reuse variables or hardcode them to keep admin distinct from game theme */
/* For now, let's leave Admin styles hardcoded so themes don't break the editor interface */

/* PROFILE PANEL */
.profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
}

.quality-category-card {
    background: var(--bg-panel);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 1.5rem;
}

.profile-quality-item {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-light);
}

.profile-quality-item:last-child {
    border-bottom: none;
}

.q-name {
    font-weight: bold;
    color: var(--text-primary);
}

.q-val {
    font-weight: bold;
    color: var(--accent-highlight);
}

.q-desc {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin: 0.25rem 0 0 0;
    line-height: 1.4;
}

.mini-progress-bar {
    height: 4px;
    background: var(--progress-bg);
    margin-top: 0.5rem;
    border-radius: 2px;
    overflow: hidden;
}

.mini-progress-bar .fill {
    height: 100%;
    background: var(--progress-fill);
}

.london-banner img, .banner-bg-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center 20%; 
}

.w-full { width: 100%; }
.h-full { height: 100%; }
.object-cover { object-fit: cover; }

/* --- ADMIN PANEL STYLES --- */
.admin-layout {
    display: flex;
    min-height: 100vh;       /* Allow page to grow */
    width: 100%;
    background-color: #181a1f;
    color: white;
    position: relative;
}

.admin-sidebar {
    width: 250px;
    background-color: #21252b;
    border-right: 1px solid #333;
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    
    /* LOCK TO VIEWPORT */
    position: sticky;
    top: 0;
    height: 100vh;
    z-index: 20;
}

.admin-help-sidebar {
    /* Change width: 300px to width: auto */
    width: auto; 
    max-width: 320px;
    
    border-left: 1px solid #333;
    background: #21252b;
    flex-shrink: 0;
    
    position: sticky;
    top: 0;
    height: 100vh;
    /* Remove overflow-y: auto here; we will handle scrolling INSIDE the component */
    display: flex;
    flex-direction: column;
    z-index: 30;
}

.admin-header {
    padding: 1rem;
    font-size: 1.2rem;
    font-weight: bold;
    border-bottom: 1px solid #333;
}

.admin-nav {
    flex: 1;
    overflow-y: auto; /* Scroll internal links if screen is tiny */
    padding: 1rem 0;
}

.admin-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.admin-link {
    display: block;
    padding: 0.5rem 1rem;
    color: #aaa;
    text-decoration: none;
    transition: background 0.2s, color 0.2s;
}

.admin-link:hover {
    background-color: #2c313a;
    color: white;
}

.admin-main {
    flex: 1;
    display: flex;
    flex-direction: row;
    min-width: 0; /* Fixes flexbox overflow issues */
}

.admin-content-wrapper {
    flex: 1;
    padding: 2rem;
    /* No overflow hidden here - let it scroll the window */
}

/* Admin List View */
.admin-split-view {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start; /* Align top so columns don't stretch weirdly */
}

.admin-list-col {
    width: 300px;
    flex-shrink: 0;
    /* Optional: Make the list sticky too so it stays visible while editing? */
    position: sticky;
    top: 2rem; 
    max-height: calc(100vh - 4rem);
    overflow-y: auto;
    
    background-color: #21252b;
    border: 1px solid #333;
    border-radius: 4px;
}

.admin-editor-col {
    flex: 1;
    background-color: #21252b;
    border: 1px solid #333;
    border-radius: 4px;
    padding: 1.5rem;
    /* No height limit, let it grow the page */
}

.list-header {
    padding: 0.75rem;
    border-bottom: 1px solid #333;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.new-btn {
    background: none;
    border: none;
    color: #98c379;
    cursor: pointer;
    font-weight: bold;
}

.list-items {
    flex: 1;
    overflow-y: auto;
}

.list-item {
    padding: 0.75rem;
    border-bottom: 1px solid #2c313a;
    cursor: pointer;
    transition: background 0.1s;
}

.list-item:hover {
    background-color: #2c313a;
}

.list-item.active {
    background-color: #2c313a;
    border-left: 3px solid #61afef;
}

.item-title {
    font-weight: bold;
    display: block;
}

.item-subtitle {
    font-size: 0.8rem;
    color: #777;
}

.admin-editor-col {
    flex: 1;
    background-color: #21252b;
    border: 1px solid #333;
    border-radius: 4px;
    padding: 1.5rem;
    overflow: hidden; /* Prevent outer scrollbar */
    display: flex;
    flex-direction: column;
}

.form-group {
    margin-bottom: 1rem;
}

.form-label {
    display: block;
    font-size: 0.85rem;
    color: #aaa;
    margin-bottom: 0.25rem;
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    background-color: #181a1f;
    border: 1px solid #333;
    color: white;
    padding: 0.5rem;
    border-radius: 4px;
    font-family: inherit;
}

.form-textarea {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box; /* Critical for padding not adding to width */
    resize: vertical; /* Allow user to resize height only */
}

.form-input {
    width: 100%;
    box-sizing: border-box;
}

.form-input:focus, .form-textarea:focus {
    border-color: #61afef;
    outline: none;
}

.form-row {
    display: flex;
    gap: 1rem;
}

.form-row > div {
    flex: 1;
}

.save-btn {
    background-color: #2a3e5c;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    float: right;
}

.save-btn:hover {
    background-color: #3e5a8a;
}

.save-btn:disabled {
    background-color: #444;
    cursor: not-allowed;
}

/* --- ADMIN CHEAT SHEET --- */
.cheat-sheet-container {
    width: 300px;
    background-color: #21252b;
    border-left: 1px solid #333;
    padding: 1.5rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    height: 100%;
    box-sizing: border-box;
}

.cheat-sheet-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #333;
}

.cheat-sheet-header h3 {
    font-weight: bold;
    color: #fff;
    margin: 0;
    font-size: 1.1rem;
}

.cheat-sheet-close {
    color: #777;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.2rem;
    padding: 0;
}

.cheat-sheet-close:hover {
    color: white;
}

.cheat-section {
    margin-bottom: 2rem;
}

.cheat-section h4 {
    color: #98c379;
    font-size: 0.85rem;
    margin: 0 0 0.75rem 0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: bold;
    border-bottom: 1px solid #2c313a;
    padding-bottom: 0.25rem;
}

.cheat-item {
    margin-bottom: 1rem;
}

.cheat-code {
    display: block;
    background-color: #282c34;
    padding: 0.5rem;
    border-radius: 4px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.8rem;
    color: #61afef;
    border: 1px solid #333;
    margin-bottom: 0.25rem;
    word-break: break-all; /* Prevents overflow */
}

.cheat-desc {
    font-size: 0.8rem;
    color: #abb2bf;
    margin: 0;
    line-height: 1.4;
}

/* Special subsection style */
.cheat-subsection {
    margin-top: 1rem;
    padding-left: 0.75rem;
    border-left: 2px solid #444;
}

.cheat-sub-title {
    display: block;
    color: #e5c07b; /* Yellowish for sub-headers */
    font-size: 0.75rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
}

.cheat-toggle-btn {
    writing-mode: vertical-rl;
    padding: 1rem;
    background-color: #21252b;
    border: none;
    border-left: 1px solid #333;
    cursor: pointer;
    color: #aaa;
    height: 100%;
    font-weight: bold;
    letter-spacing: 1px;
    transition: background 0.2s;
}

.cheat-toggle-btn:hover {
    background-color: #2c313a;
    color: white;
}

/* Add to src/app/globals.css */

.special-field-group {
    background-color: #21252b; /* Matches panel bg */
    border: 1px dashed #d19a66; /* Subtle orange/gold for logic */
    padding: 1rem;
    border-radius: 4px;
    margin-bottom: 1rem;
}

.special-label {
    display: block;
    font-size: 0.85rem;
    color: #d19a66; /* Matches border */
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.special-desc {
    font-size: 0.75rem;
    color: #aaa;
    margin-top: 0.5rem;
    margin-bottom: 0;
}

.outcome-column {
    min-width: 300px;
    flex: 1;
    border-radius: 4px;
    padding: 0.75rem;
    box-sizing: border-box; /* Keep padding inside */
}

/* Admin Form Footer */
.admin-form-footer {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid #333;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Property Hint Text */
.property-hint {
    font-size: 0.7rem;
    color: #61afef;
    font-family: monospace;
    margin-left: 0.5rem;
    opacity: 0.8;
}

/* Toggle Checkbox Row */
.toggle-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 4px;
}

.toggle-label {
    font-size: 0.85rem;
    color: #ccc;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.theme-wrapper {
    color: var(--text-primary);
    background: var(--bg-main);
    font-family: var(--font-main);

    --_bg-panel: var(--bg-panel);
    --_bg-item: var(--bg-item);
    --_text-primary: var(--text-primary);
    --_border-color: var(--border-color);
}

button, input, textarea, select, h1 {
    font-family: inherit; /* Inherit var(--font-main) from body */
    color: inherit;
}

[data-theme='terminal'] h1,
[data-theme='terminal'] h2,
[data-theme='terminal'] h3,
[data-theme='terminal'] p,
[data-theme='terminal'] .storylet-text,
[data-theme='terminal'] .option-short-desc,
[data-theme='terminal'] .quality-name,
[data-theme='terminal'] .quality-level,
[data-theme='terminal'] button {
    text-shadow: 0 0 5px rgba(51, 255, 0, 0.5), 0 0 10px rgba(51, 255, 0, 0.3);
}

[data-theme='arcanotech'] .storylet-container,
[data-theme='arcanotech'] .card,
[data-theme='arcanotech'] .character-sheet,
[data-theme='arcanotech'] .quality-category-card,
[data-theme='arcanotech'] .equip-slot {
    border-color: rgba(var(--accent-highlight-rgb), 0.4);
    box-shadow: 0 0 12px rgba(var(--accent-highlight-rgb), 0.15);
    transition: border-color 0.3s, box-shadow 0.3s;
}

/* Make the glow stronger on hover for interactive elements */
[data-theme='arcanotech'] .card:hover {
    border-color: rgba(var(--accent-highlight-rgb), 0.8);
    box-shadow: 0 0 16px rgba(var(--accent-highlight-rgb), 0.3);
}

/* REVISED and CORRECTED RULE: Art Deco panels using four corner masks */
[data-theme='art-deco'] .storylet-container,
[data-theme='art-deco'] .character-sheet,
[data-theme='art-deco'] .quality-category-card {
    position: relative;
    padding: 2rem;
    
    /* Create the straight border lines with a gradient */
    border: 2px solid transparent;
    background-clip: padding-box;
    border-image: linear-gradient(45deg, #f5d88a, #a88949);
    border-image-slice: 1;
}

/* This pseudo-element will hold ALL FOUR corner graphics */
[data-theme='art-deco'] .storylet-container::before,
[data-theme='art-deco'] .character-sheet::before,
[data-theme='art-deco'] .quality-category-card::before {
    content: '';
    position: absolute;
    top: -2px; left: -2px; /* Align with the border edge */
    right: -2px; bottom: -2px;
    
    /* Use the gold gradient for the corners' color */
    background: linear-gradient(45deg, #f5d88a, #a88949);

    /* The magic: use the FOUR SVGs as masks */
    mask-image: url('/themes/art-deco/corner-tl.svg'), /* Top Left */
                url('/themes/art-deco/corner-tr.svg'), /* Top Right */
                url('/themes/art-deco/corner-bl.svg'), /* Bottom Left */
                url('/themes/art-deco/corner-br.svg'); /* Bottom Right */
                
    mask-size: 20px 20px; /* The size of our SVG graphic */
    mask-repeat: no-repeat;
    
    /* Position each of the four masks */
    mask-position: top left, top right, bottom left, bottom right;
    
    /* NO TRANSFORM NEEDED! */
}

[data-theme='stone-dwarven'] .storylet-container,
[data-theme='stone-dwarven'] .character-sheet,
[data-theme='stone-dwarven'] .option-button,
[data-theme='stone-dwarven'] .card {
    border: 1px solid var(--shadow-dark);
    box-shadow: -2px -2px 5px var(--shadow-light), 
                2px 2px 5px var(--shadow-dark);
    text-shadow: 1px 1px 2px var(--shadow-dark);
    transition: box-shadow 0.1s ease-out;
}

[data-theme='stone-dwarven'] .option-button:active,
[data-theme='stone-dwarven'] .card:active {
    /* Inset shadow: Dark on top/left, Light on bottom/right creates a depressed look */
    box-shadow: inset 2px 2px 5px var(--shadow-dark), 
                inset -2px -2px 5px var(--shadow-light);
}

[data-theme='corpocracy'] .storylet-container,
[data-theme='corpocracy'] .character-sheet,
[data-theme='corpocracy'] .card,
[data-theme='corpocracy'] .option-button {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px); /* For Safari */
    border: 1px solid rgba(255, 255, 255, 0.1); /* Faint white border */
}

[data-theme='cyberpunk'] .option-button:hover h3,
[data-theme='cyberpunk'] .card:hover h3,
[data-theme='cyberpunk'] .deck-button:hover,
[data-theme='cyberpunk'] .continue-button:hover {
    animation: glitch 0.35s infinite linear;
}

[data-theme='witch-folk'] .storylet-container,
[data-theme='witch-folk'] .character-sheet,
[data-theme='witch-folk'] .quality-category-card {
    border-style: solid;
    border-width: 15px;
    border-image-source: url('/themes/witch-folk/border.svg');
    border-image-slice: 20;
    border-image-repeat: round;
    padding: 2rem;
}

/* NEW: Add a subtle mossy glow on hover for interactive cards */
[data-theme='witch-folk'] .card:hover {
    box-shadow: 0 0 15px rgba(168, 183, 108, 0.2); /* Use the --accent-highlight color */
}

[data-theme='jrpg-bright'] .option-button,
[data-theme='jrpg-bright'] .card {
    position: relative; /* Needed to position the pseudo-element */
}

[data-theme='jrpg-bright'] .option-button:hover::before,
[data-theme='jrpg-bright'] .card:hover::before {
    content: ''; /* A classic pointer character */
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--accent-highlight); /* JRPG Gold */
    font-size: 1.2rem;
    animation: bounce-right 0.6s infinite;
}

/* NEW: Animation for the pointer */
@keyframes bounce-right {
  0%, 100% { transform: translateY(-50%) translateX(0); }
  50% { transform: translateY(-50%) translateX(5px); }
}

/* NEW: Adjust padding on buttons to make space for the pointer */
[data-theme='jrpg-bright'] .option-content-wrapper {
    padding-left: 2.5rem;
}
[data-theme='jrpg-bright'] .card-text {
    padding-left: 2.5rem;
}

/* NEW: The scan line overlay */
[data-theme='vaporwave']::after {
    content: '';
    position: fixed; /* Fixed position covers the entire viewport */
    top: 0;
    left: 0;
    width: 100vw; /* Use viewport units for full coverage */
    height: 100vh;
    pointer-events: none; /* Allows clicks to pass through */
    z-index: 9999; /* High z-index to ensure it's on top of everything */
    
    /* A more defined and controllable background for the lines */
    background-image: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0) 0px,
        rgba(0, 0, 0, 0) 2px,
        rgba(255, 255, 255, 0.05) 3px, /* A faint white/cyan glow */
        rgba(0, 0, 0, 0.2) 4px
    );
    background-size: 100% 4px; /* Explicitly set the size of the repeating pattern */
    
    animation: scroll-scanlines 20s linear infinite;
    opacity: 0.4; /* Soften the overall effect */
}

[data-theme='parchment'] .storylet-container,
[data-theme='parchment'] .character-sheet,
[data-theme='parchment'] .card {
    border: 1px solid #c8bca2;
    /* Multiple inset shadows create a layered, singed look */
    box-shadow: inset 0 0 5px #a1887f, /* Inner light brown */
                inset 0 0 10px #795548, /* Darker brown */
                inset 0 0 15px #3e2723; /* Almost black char */
}

/* For interactive items, make the burn more intense on hover */
[data-theme='parchment'] .card:hover {
    box-shadow: inset 0 0 8px #a1887f,
                inset 0 0 15px #795548,
                inset 0 0 25px #3e2723,
                0 0 10px rgba(62, 39, 35, 0.3); /* Add a subtle outer glow */
}

/* [data-theme='noir']::after {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="10" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
    background-size: 100px 100px;    pointer-events: none;
    z-index: 9999;
    animation: film-grain-flicker 0.2s infinite;
} */

[data-theme='imperial-rome'] h1,
[data-theme='imperial-rome'] h2,
[data-theme='imperial-rome'] h3,
[data-theme='imperial-rome'] .location-text h1,
[data-theme='imperial-rome'] .quality-name {
    /* The text shadow creates a highlight and a shadow, giving a 3D inset look */
    text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.4), 
                 -1px 1px 1px rgba(255, 255, 255, 0.4);
    color: var(--text-primary);
}

/* [data-theme='cyberpunk'] .storylet-container,
[data-theme='cyberpunk'] .character-sheet,
[data-theme='cyberpunk'] .quality-category-card {
    position: relative;
    border: none;
    padding: 1.75rem;
} */

/* [data-theme='druidic'] .storylet-container,
[data-theme='druidic'] .character-sheet,
[data-theme='druidic'] .quality-category-card {
    border-style: solid;
    border-width: 12px;
    border-image-source: url('/themes/druidic/knot-border.svg');
    border-image-slice: 10;
    border-image-repeat: round;
    padding: 1.5rem;
} */


[data-theme='arabesque'] .storylet-container,
[data-theme='arabesque'] .character-sheet,
[data-theme='arabesque'] .quality-category-card {
    background-image: url('/themes/arabesque/tile.svg');
    background-size: 50px 50px;
    background-color: var(--bg-panel);
}

[data-theme='revolutionary'] .storylet-container,
[data-theme='revolutionary'] .character-sheet {
    position: relative;
    padding: 2rem;
    border: 2px solid var(--accent-primary);
}


/* NEW: Apply the ink texture overlay */
[data-theme='revolutionary'] .storylet-container::after,
[data-theme='revolutionary'] .character-sheet::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--accent-primary);
    opacity: 0.1;
    filter: url('/themes/revolutionary/ink-texture.svg'); /* Use the SVG filter */
    pointer-events: none;
}

[data-theme='abyssal']::before,
[data-theme='abyssal']::after {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 1px; /* The element itself is tiny */
    height: 1px;
    border-radius: 50%;
    z-index: 1;
}

/* Layer 1: Slower, larger particles */
[data-theme='abyssal']::before {
    animation: drift-particles 90s linear infinite;
    /* Generate 50 particles with a huge box-shadow */
    box-shadow: 23vw 84vh 1px 1px #27f2da, 69vw 8vh 1px 1px #27f2da, 59vw 74vh 0px 0px #27f2da, 55vw 52vh 1px 1px #27f2da, 4vw 77vh 1px 1px #27f2da, 32vw 73vh 1px 1px #27f2da, 94vw 9vh 1px 1px #27f2da, 95vw 82vh 1px 1px #27f2da, 5vw 92vh 0px 0px #27f2da, 18vw 36vh 1px 1px #27f2da, 54vw 4vh 1px 1px #27f2da, 48vw 33vh 0px 0px #27f2da, 49vw 10vh 1px 1px #27f2da, 62vw 18vh 1px 1px #27f2da, 7vw 3vh 1px 1px #27f2da, 16vw 21vh 0px 0px #27f2da, 82vw 35vh 1px 1px #27f2da, 49vw 82vh 0px 0px #27f2da, 53vw 38vh 1px 1px #27f2da, 58vw 7vh 1px 1px #27f2da, 5vw 55vh 1px 1px #27f2da, 15vw 91vh 1px 1px #27f2da, 87vw 81vh 1px 1px #27f2da, 60vw 62vh 1px 1px #27f2da, 34vw 59vh 1px 1px #27f2da;
}

/* Layer 2: Faster, smaller particles */
[data-theme='abyssal']::after {
    animation: drift-particles-2 60s linear infinite;
    box-shadow: 20vw 15vh 0px 0px #27f2da, 6vw 48vh 0px 0px #27f2da, 36vw 98vh 0px 0px #27f2da, 96vw 24vh 0px 0px #27f2da, 78vw 80vh 0px 0px #27f2da, 56vw 90vh 0px 0px #27f2da, 64vw 54vh 0px 0px #27f2da, 44vw 2vh 0px 0px #27f2da, 3vw 16vh 0px 0px #27f2da, 8vw 27vh 0px 0px #27f2da, 53vw 3vh 0px 0px #27f2da, 28vw 46vh 0px 0px #27f2da, 30vw 23vh 0px 0px #27f2da, 1vw 76vh 0px 0px #27f2da, 93vw 60vh 0px 0px #27f2da, 89vw 44vh 0px 0px #27f2da, 73vw 12vh 0px 0px #27f2da, 83vw 95vh 0px 0px #27f2da, 41vw 66vh 0px 0px #27f2da, 12vw 63vh 0px 0px #27f2da, 25vw 88vh 0px 0px #27f2da, 98vw 1vh 0px 0px #27f2da, 9vw 99vh 0px 0px #27f2da, 33vw 85vh 0px 0px #27f2da, 10vw 8vh 0px 0px #27f2da;
}

/* NEW: Apply the rough paper texture to the whole page */
html[data-theme='revolutionary']::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background-image: url('/themes/revolutionary/paper-texture.svg');
    opacity: 0.3;
    pointer-events: none;
    z-index: -1;
}

/* NEW: Apply the bold, asymmetric color blocks */
[data-theme='revolutionary'] .storylet-container,
[data-theme='revolutionary'] .character-sheet {
    position: relative;
    border: 2px solid var(--text-primary);
    padding: 2rem;
    overflow: hidden; /* Crucial to contain the pseudo-elements */
}

/* Red block - ::before */
[data-theme='revolutionary'] .storylet-container::before {
    content: '';
    position: absolute;
    top: -20%;
    left: -10%;
    width: 60%;
    height: 50%;
    background: var(--accent-primary);
    transform: rotate(-15deg);
    opacity: 0.8;
    z-index: -1;
}

/* Blue block - ::after */
[data-theme='revolutionary'] .storylet-container::after {
    content: '';
    position: absolute;
    bottom: -25%;
    right: -15%;
    width: 70%;
    height: 60%;
    background: var(--accent-secondary);
    transform: rotate(10deg);
    opacity: 0.8;
    z-index: -1;
}

/* We can add a different layout for the smaller character sheet */
[data-theme='revolutionary'] .character-sheet::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 25%;
    background: var(--accent-primary);
    clip-path: polygon(0 0, 100% 30%, 100% 100%, 0% 100%);
    opacity: 0.8;
    z-index: -1;
}

/* Use the highlight yellow for titles and important elements */
[data-theme='revolutionary'] .option-button:hover h3 {
    color: var(--text-primary);
    /* Add a yellow "stamped" background */
    background: var(--accent-highlight);
    padding: 0.1em 0.3em;
    box-shadow: 3px 3px 0px var(--accent-secondary); /* Add a blue drop shadow */
    display: inline; /* Allows background to wrap tightly */
}

@keyframes data-flicker {
  0%, 100% { color: var(--text-primary); }
  50% { color: var(--accent-highlight); }
}

/* --- STARSHIP BRIDGE --- */
[data-theme='starship'] {
    --bg-main: #000000;
    --bg-panel: #000000;
    --bg-item: #1a1a1a;
    --bg-item-hover: #333333;
    --border-color: #6666cc; /* LCARS Blue */
    --border-light: #9999ff;
    --text-primary: #ffcc99; /* LCARS Peach */
    --text-secondary: #ccccff;
    --text-muted: #9999cc;
    --accent-primary: #cc6666; /* LCARS Red/Orange */
    --accent-hover: #ff9999;
    --accent-highlight: #ffff99; /* Yellow for highlights */
    --success-color: #99ff99;
    --danger-color: #ff6666;
    --progress-bg: #1a1a1a;
    --progress-fill: #9999ff;
    --font-main: var(--font-montserrat), sans-serif;
    --border-radius: 4px;
}


/* The side "elbow" piece */
[data-theme='starship'] .storylet-container::before {
    content: '';
    background: var(--accent-primary);
    border-radius: 5px 0 0 0;
}

/* Container for the main text */
[data-theme='starship'] .storylet-main-content {
    background: var(--bg-item);
    padding: 1rem;
}

/* Apply the data flicker to some elements */
[data-theme='starship'] .quality-level,
[data-theme='starship'] .item-count {
    animation: data-flicker 10s infinite;
    /* Stagger the animation for a more natural look */
    animation-delay: calc(var(--i, 1) * 0.7s);
}



/* --- DOCUMENTATION THEME --- */

.docs-wrapper {
    display: flex;
    min-height: 100vh;
    background-color: #181a1f;
    color: #abb2bf;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* Docs Sidebar */
.docs-nav {
    width: 250px;
    background-color: #21252b;
    border-right: 1px solid #333;
    padding: 2rem;
    position: sticky;
    top: 0;
    height: 100vh;
    flex-shrink: 0;
    overflow-y: auto;
}

.docs-nav-header {
    font-size: 1.2rem;
    font-weight: bold;
    color: #fff;
    margin-bottom: 1.5rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 1px solid #444;
    padding-bottom: 1rem;
}

.docs-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.docs-nav li {
    margin-bottom: 0.8rem;
}

.docs-nav a {
    color: #999;
    text-decoration: none;
    transition: color 0.2s;
    font-size: 0.95rem;
    display: block;
}

.docs-nav a:hover {
    color: #61afef;
    padding-left: 5px;
}

/* Docs Main Content */
.docs-main {
    flex: 1;
    padding: 4rem 6rem;
    max-width: 1000px;
}

/* Typography */
.docs-h1 { font-size: 3rem; color: #fff; margin-bottom: 0.5rem; line-height: 1.1; margin-top: 0; }
.docs-lead { font-size: 1.3rem; color: #777; margin-bottom: 2rem; font-weight: 300; }
.docs-divider { border: 0; border-bottom: 1px solid #333; margin: 4rem 0; }

.docs-h2 { color: #61afef; font-size: 2.2rem; margin-top: 0; margin-bottom: 1.5rem; border-bottom: 1px solid #2c313a; padding-bottom: 0.5rem; }
.docs-h3 { color: #98c379; font-size: 1.5rem; margin-top: 3rem; margin-bottom: 1rem; }
.docs-h4 { color: #e5c07b; font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: bold; }

.docs-p, .docs-li { line-height: 1.7; font-size: 1.05rem; margin-bottom: 1rem; color: #c8ccd4; }
.docs-strong { color: #fff; font-weight: 600; }

/* Components */
.docs-callout { 
    background: rgba(97, 175, 239, 0.1); 
    border-left: 4px solid #61afef; 
    padding: 1.5rem; 
    border-radius: 4px; 
    margin: 2rem 0; 
    color: #d7dae0; 
    line-height: 1.6;
}

.docs-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
    gap: 1.5rem; 
    margin: 2rem 0; 
}

.docs-card { 
    background: #21252b; 
    padding: 1.5rem; 
    border-radius: 8px; 
    border: 1px solid #333; 
    transition: transform 0.2s; 
}

.docs-card:hover { transform: translateY(-2px); border-color: #61afef; }
.docs-card h4 { margin-top: 0; color: #61afef; font-size: 1.1rem; text-transform: uppercase; font-weight: bold; margin-bottom: 0.5rem; }
.docs-card small { display: block; margin-top: 1rem; color: #777; font-style: italic; }

.docs-table { 
    width: 100%; 
    border-collapse: collapse; 
    margin: 2rem 0; 
    background: #21252b; 
    border-radius: 8px; 
    overflow: hidden; 
}

.docs-table th, .docs-table td { border-bottom: 1px solid #333; padding: 1rem; text-align: left; vertical-align: top; line-height: 1.5; color: #ccc; }
.docs-table th { background: #2c313a; color: #fff; font-weight: bold; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
.docs-table tr:last-child td { border-bottom: none; }

.docs-pre { 
    background: #282c34; 
    padding: 1rem; 
    border-radius: 6px; 
    border: 1px solid #333; 
    overflow-x: auto; 
    margin: 1rem 0; 
}

.docs-code { 
    font-family: 'Consolas', 'Monaco', monospace; 
    color: #e06c75; 
    background: rgba(0,0,0,0.3); 
    padding: 2px 6px; 
    border-radius: 4px; 
    font-size: 0.9rem; 
}

.docs-pre .docs-code { background: transparent; padding: 0; color: #98c379; }

.docs-syntax-box { 
    background: #1e2127; 
    border: 1px dashed #5c6370; 
    padding: 1.5rem; 
    text-align: center; 
    margin: 2rem 0; 
    border-radius: 8px; 
}

[data-theme='dark-parchment'] {
    /* Backgrounds: dark base with subtle parchment texture */
    --bg-main: #1a1612 url('/themes/parchment/bg.jpg'); /* Dark but textured */
    --bg-panel: rgba(50, 45, 38, 0.85); /* Dark panel with parchment warmth */
    --bg-item: rgba(70, 60, 50, 0.6);
    --bg-item-hover: rgba(90, 80, 65, 0.8);

    /* Borders: soft brown tones */
    --border-color: #7a6050;
    --border-light: #9c826d;

    /* Text: readable on dark background but warm */
    --text-primary: #e0d4c3; /* Soft cream */
    --text-secondary: #cbb79a; 
    --text-muted: #a88f74;

    /* Accents: dark-fantasy with parchment warmth */
    --accent-primary: #8d6e5c;
    --accent-hover: #a1887f;
    --accent-highlight: #b23b2b; /* Wax seal red inspired */

    /* Status colors */
    --success-color: #6b8c6b; 
    --danger-color: #c62828;

    --progress-bg: rgba(100, 90, 80, 0.5);
    --progress-fill: #b23b2b;

    /* Font & shape */
    --font-main: var(--font-garamond), "Georgia", serif;
    --border-radius: 3px;
}

/* Panels, cards, and storylets with parchment-influenced shadows */
[data-theme='dark-parchment'] .storylet-container,
[data-theme='dark-parchment'] .character-sheet,
[data-theme='dark-parchment'] .card {
    border: 1px solid #8d6e5c;
    box-shadow: inset 0 0 5px #9c826d,
                inset 0 0 10px #7a6050,
                inset 0 0 15px rgba(0,0,0,0.6);
}

[data-theme='dark-parchment'] .card:hover {
    box-shadow: inset 0 0 8px #9c826d,
                inset 0 0 15px #7a6050,
                inset 0 0 25px rgba(0,0,0,0.6),
                0 0 10px rgba(224, 212, 195, 0.3); /* subtle parchment glow */
}

/* --- LAYOUT UTILITIES --- */

.layout-screen {
    height: 100vh;
    display: flex;
    overflow: hidden;
    background-color: var(--bg-main);
    color: var(--text-primary);
}

.layout-column {
    display: flex;
    flex-direction: column;
}

.sidebar-panel {
    width: 280px;
    flex-shrink: 0;
    /* background-color: var(--bg-panel); */
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    z-index: 10;
}

.glass-sidebar {
    background: rgba(10, 10, 15, 0.7);
    backdrop-filter: blur(15px);
    border-right: 1px solid rgba(255,255,255,0.1);
}

.content-area {
    flex: 1;
    overflow-y: auto;
    position: relative;
}

.tab-bar {
    display: flex;
    gap: 1rem;
    border-bottom: 1px solid var(--border-color);
    background-color: var(--bg-item);
    padding: 0 1rem;
}

.tab-btn {
    padding: 1rem 1.5rem;
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--text-muted);
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 1px;
    transition: color 0.2s, border-color 0.2s;
}

.tab-btn:hover {
    color: var(--text-primary);
}

.tab-btn.active {
    color: var(--accent-highlight);
    border-bottom-color: var(--accent-highlight);
}

.action-box {
    margin-bottom: 1rem;
    padding: 1rem;
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    text-align: center;
}

.switch-char-btn {
    width: 100%;
    background: rgba(231, 76, 60, 0.1);
    border: 1px solid rgba(231, 76, 60, 0.4);
    color: var(--danger-color);
    padding: 0.8rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    text-transform: uppercase;
    font-size: 0.75rem;
    font-weight: bold;
    transition: all 0.2s;
}

.switch-char-btn:hover {
    background: rgba(231, 76, 60, 0.2);
    border-color: var(--danger-color);
}

/* --- SPECIFIC LAYOUT GRIDS --- */

/* Nexus: Fixed Left Sidebar + Fluid Content */
.layout-grid-nexus {
    display: grid;
    grid-template-columns: 320px 1fr; /* Slightly wider sidebar for Nexus */
    height: 100vh;
    overflow: hidden;
    /* background-color: var(--bg-main); */
}

/* Tabletop: Character | Visual | Story */
.layout-grid-tabletop {
    display: grid;
    grid-template-columns: 280px minmax(300px, 35%) 1fr; /* 3 Columns */
    height: 100vh;
    overflow: hidden;
    background-color: #121212;
    color: #ccc;
}

/* Visual Column for Tabletop (Center) */
.tabletop-visual-col {
    position: relative;
    overflow: hidden;
    border-right: 1px solid #333;
    background: #000;
    box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
    z-index: 1;
}

.tabletop-visual-overlay {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle, transparent 40%, #000 120%);
    pointer-events: none;
}

.docs-content {
    max-width: 850px;
    margin: 0 auto;
    color: #ccc;
    line-height: 1.8;
    font-size: 1.05rem;
}

/* Typography */
.docs-h1 {
    font-size: 3rem;
    color: #fff;
    margin-bottom: 0.5rem;
    line-height: 1.1;
    margin-top: 0;
}

.docs-lead {
    font-size: 1.3rem;
    color: #888;
    margin-bottom: 3rem;
    font-weight: 300;
}

.docs-h2 {
    color: #61afef; /* Blue */
    font-size: 2rem;
    margin-top: 4rem;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid #2c313a;
    padding-bottom: 0.5rem;
    scroll-margin-top: 2rem;
}

.docs-h3 {
    color: #98c379; /* Green */
    font-size: 1.4rem;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    font-weight: bold;
}

.docs-h4 {
    color: #e5c07b; /* Yellow */
    font-size: 1rem;
    margin-top: 0;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: bold;
}

.docs-p {
    margin-bottom: 1.5rem;
    color: #d7dae0;
}

.docs-list {
    margin: 1.5rem 0;
    padding-left: 1.5rem;
    color: #d7dae0;
}

.docs-li {
    margin-bottom: 0.75rem;
}

.docs-divider {
    border: 0;
    border-bottom: 1px solid #333;
    margin: 4rem 0;
}

/* Components */
.docs-callout {
    background: rgba(97, 175, 239, 0.1);
    border-left: 4px solid #61afef;
    padding: 1.5rem;
    border-radius: 4px;
    margin: 2rem 0;
}

.docs-card {
    background: #21252b;
    border: 1px solid #333;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
}

.docs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.docs-code {
    font-family: 'Consolas', 'Monaco', monospace;
    color: #e06c75; /* Red/Pink */
    background: rgba(0,0,0,0.3);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9rem;
}

.docs-syntax-box {
    background: #1e2127;
    border: 1px dashed #5c6370;
    padding: 1.5rem;
    text-align: center;
    margin: 2rem 0;
    border-radius: 8px;
    font-family: monospace;
    color: #61afef;
    font-size: 1.2rem;
}

.docs-pre {
    background: #282c34;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #333;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-family: monospace;
}

/* Links */
.docs-link {
    color: #61afef;
    text-decoration: none;
    border-bottom: 1px dotted #61afef;
}
.docs-link:hover {
    border-bottom: 1px solid #61afef;
}

.docs-syntax-box .docs-code { font-size: 1.4rem; color: #61afef; background: none; }

.docs-props-list { list-style: none; padding: 0; }
.docs-props-list li { margin-bottom: 1.5rem; background: #21252b; padding: 1rem; border-radius: 6px; border: 1px solid #333; }
.docs-props-list .docs-code { display: inline-block; margin-bottom: 0.5rem; color: #e5c07b; font-size: 1rem; }
.docs-props-list span { display: block; color: #abb2bf; line-height: 1.5; }

.cost-badge {
    font-size: 0.75rem;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 10px;
    white-space: nowrap;
}
.cost-numeric {
    color: var(--danger-color);
    background: rgba(0,0,0,0.3);
}
.cost-free {
    color: var(--success-color);
    background: rgba(0,0,0,0.3);
}
.cost-logic {
    color: var(--accent-highlight); /* Gold/Yellow */
    background: rgba(0,0,0,0.3);
    border: 1px dashed var(--accent-highlight);
}


/* =========================================
   THEME: BLACK CROWN (The Paranoid Archive)
   ========================================= */
[data-theme='black-crown'] {
    /* PALETTE: Mossy Void & Manila Folders */
    
    /* NEW: Variables for the "Mysterious Void" gradient */
    --bg-main: #1a1917; /* A very dark, warm gray for the absolute edge */

/* NEW: Brighter, more open gradient colors */
--bg-void-dark: #2d2b27;    /* Keeps the edges dark for contrast */
--bg-void-mid: #7a786f;     /* A wider, softer mid-tone to smooth the gradient */
--bg-void-light: #d0eaaa;   /* A very bright, aged paper/bone color for the center */ /* A much brighter, dusty khaki spotlight */
    /* Buff / Manila Folder Colors */
    --bg-panel: #e8e0c5; 
    --bg-item: #f3ebd0; 
    --bg-item-hover: #fffef5;
    
    --border-color: #2b261e; /* Dark Brown Ink */
    --border-light: #8c857b;
    
    --text-primary: #1a1814;
    --text-secondary: #3d3830;
    --text-muted: #6b6354;
    
    --accent-primary: #2c241b; 
    --accent-hover: #000000;
    --accent-highlight: #8a0303; /* Deep Crimson Stamp */
    
    --font-main: "Special Elite", "Courier New", monospace;
    --border-radius: 2px;
    
    /* UTILS */
    --shadow-paper: 0 2px 4px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.1);
    --shadow-float: 0 15px 30px rgba(0,0,0,0.5);
}

/* 1. BACKGROUND: The Mossy Archive */
[data-theme='black-crown'].theme-wrapper {
    /*
       THE FIX: We use the single 'background' shorthand property.
       This correctly layers the gradient ON TOP of the fallback color.
       Layers are listed from top to bottom, with the final color being the base layer.
    */
     background:
        /* Layer 3 (Top): The Noise Texture */
        url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E") fixed,

        /* Layer 2 (Middle): The Radial Gradient */
        radial-gradient(ellipse at center, 
            var(--bg-void-light) 0%, 
            var(--bg-void-mid) 50%,
            var(--bg-void-dark) 90%
        ) fixed,

        /* Layer 1 (Bottom): The solid fallback color */
        var(--bg-main);
        
    background-blend-mode: overlay;
    background-attachment: fixed;
    min-height: 100vh;
    height: auto;
    overflow-y: auto;
    display: block; 
}

/* 2. LAYOUT GRID */
[data-theme='black-crown'] .layout-grid-nexus {
    display: grid;
    /* Wide sidebar (400px) for tabs */
    grid-template-columns: 400px minmax(0, 1fr);
    gap: 2rem;
    max-width: 1500px;
    width: 95%;
    height: 100%;
    margin: 4rem auto;
    align-items: start;
}

[data-theme='black-crown'] .tab-btn.active {
    background: var(--bg-panel); /* Try to match the image tone roughly */
    background-image: url('/themes/black-crown/sidebar_bg.jpg'); /* Match panel bg */
    background-position: top center;
    color: #000;
    border-bottom: 1px solid var(--bg-panel);
    margin-bottom: -1px;
    z-index: 5;
    box-shadow: 0 -2px 4px rgba(0,0,0,0.05);
}

/* 4. CONTENT AREA & HEADERS */
[data-theme='black-crown'] .content-area {
    overflow: visible !important;
    height: auto !important;
}

/* 1. Wrapper: Define a Grid that stacks items on top of each other */
[data-theme='black-crown'] .location-wrapper.mode-banner {
    display: grid;
    /* This creates one cell where everything lives */
    grid-template-areas: "stack"; 
    
    width: 100%;
    max-width: 1000px;
    margin: 0 auto 3rem auto;
    
    /* Decoration */
    border: 4px solid #111;
    box-shadow: var(--shadow-float);
    background: #0c140c;
    overflow: hidden;
}

/* 2. Background Layer: Dictates the height */
[data-theme='black-crown'] .banner-bg-layer {
    grid-area: stack; /* Put in the stack */
    position: relative; /* Back in the document flow */
    width: 100%;
    height: auto;       /* Allow height to grow/shrink with image */
    z-index: 0;
}

[data-theme='black-crown'] .banner-bg-layer img {
    width: 100%;
    height: auto;       /* Resize uniformly (Aspect Ratio preserved) */
    display: block;     /* Remove bottom gap */
    
    /* Visual Filters */
    mask-image: linear-gradient(to bottom, black 60%, rgba(0,0,0,0.8) 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 60%, rgba(0,0,0,0.8) 100%);
    filter: brightness(0.6) sepia(0.2) contrast(1.1);
}

/* --- SIDEBAR: The Manila Folder (Corrected Layout) --- */

/* 1. The Folder Container */
[data-theme='black-crown'] .sidebar-panel {
    background-color: var(--bg-panel);
    border: 1px solid #b8b09e;
    background-image: url('/themes/black-crown/sidebar_bg.jpg');
    background-size: cover;
    background-repeat: no-repeat;
    box-shadow: inset 0 0 25px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.3);
    
    position: sticky;
    top: 2rem;
    max-height: calc(100vh - 4rem);
    
    width: 100%;
    z-index: 10;
    
    /* NEW: Use Flexbox to manage the inner layout */
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden; /* Hide scrollbar from the folder itself */
}

/* The inner scrollable content area */
[data-theme='black-crown'] .sidebar-content-scroll {
    flex: 1 1 auto; /* Take up all available vertical space */
    overflow-y: auto;
    padding: 1.5rem;
}

/* The fixed footer area */
[data-theme='black-crown'] .sidebar-footer {
    flex-shrink: 0; /* Prevent the footer from shrinking */
    padding: 1.5rem;
    padding-top: 0;
}


/* 2. THE TABS (Recessed, Borderless Look) */
[data-theme='black-crown'] .tab-bar {
    margin: 0;
    margin-bottom: 0rem;
    padding: 0;
    gap: 0;
    display: flex;
    border-bottom: 1px solid #a8a08a;
}

[data-theme='black-crown'] .tab-btn {
    flex-grow: 1;
    background: transparent;
    color: rgba(43, 38, 30, 0.6);
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.15);
    font-family: var(--font-main);
    font-weight: bold;
    font-size: 0.8rem;
    text-transform: uppercase;
    text-align: center;
    letter-spacing: 1px;
    padding: 0.75rem 0.25rem;
    border-radius: 4px 4px 0 0;
    border: 1px solid transparent;
    border-bottom: none;
    cursor: pointer;
    transition: all 0.2s;
}

[data-theme='black-crown'] .tab-btn.active {
    background: #f4f0e4;
    color: var(--accent-highlight);
    box-shadow: none;
    border: 1px solid #a8a08a;
    border-top: 2px solid var(--accent-highlight);
    border-bottom: 1px solid #f4f0e4;
    position: relative;
    margin-bottom: -1px;
}

/* 3. The "Pasted-On" Paper Labels */
[data-theme='black-crown'] .sidebar-panel .action-box,
[data-theme='black-crown'] .sidebar-panel .character-sheet {
    background-color: #f4f0e4; 
    border: 1px solid #a8a08a; 
    box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
    padding: 1rem;
    margin: 0;
}

/* Merge the Action Box with the Tab Bar (no top margin) */
[data-theme='black-crown'] .sidebar-panel .action-box {
    border-top: none;
    border-radius: 0 0 4px 4px;
}

/* Space out the Character Sheet */
[data-theme='black-crown'] .sidebar-panel .character-sheet {
    margin-top: 1.5rem;
    border-radius: 4px;
}

/* ... (The rest of your sidebar typography and button styles can remain the same) ... */

/* Switch Character Button (Slanted Stamp) */
[data-theme='black-crown'] .switch-char-btn {
    background: transparent;
    border: 2px solid var(--accent-highlight);
    color: var(--accent-highlight);
    font-family: var(--font-main);
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.7;
    width: 100%;
    padding: 0.75rem;
    transform: rotate(-1deg);
    transition: all 0.2s;
}
[data-theme='black-crown'] .switch-char-btn:hover {
    background: rgba(138, 3, 3, 0.05);
    opacity: 1;
    transform: rotate(0deg) scale(1.01);
}
/* 4. Text Styling */
[data-theme='black-crown'] .location-wrapper.mode-banner .location-text {
    text-align: left;
    margin-right: auto;
    text-shadow: 0 2px 5px rgba(0,0,0,0.9);
}

[data-theme='black-crown'] .location-wrapper.mode-banner h1 {
    font-size: 3rem;
    color: #fff;
    border-bottom: 2px solid rgba(255,255,255,0.4);
    margin: 0;
    line-height: 1;
    display: inline-block;
}

[data-theme='black-crown'] .location-wrapper.mode-banner h2 {
    color: #ddd;
    font-style: italic;
    font-size: 1.1rem;
    margin: 0 0 0.5rem 0;
    opacity: 0.9;
}
/* 3. Header Content: Floats on top within the same stack */
[data-theme='black-crown'] .location-wrapper.mode-banner .location-header {
    grid-area: stack; 
    align-self: end;  
    
    position: relative;
    z-index: 1;
    width: 100%;
    
    /* Spacing */
    padding: 2rem 2rem 0.5rem 2rem; 
    
    /* FIX: Include padding in width calculation */
    box-sizing: border-box; 
    
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    transform: none;
}
/* 5. Buttons */
[data-theme='black-crown'] .location-wrapper.mode-banner .location-header > div:last-child {
    align-items: flex-end; 
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
}

/* Cleanup */
[data-theme='black-crown'] .location-wrapper.mode-banner .location-header::after { display: none; }
[data-theme='black-crown'] .location-wrapper.mode-banner .location-image-container { display: none; }

/* 5. MAIN STORYLET (Case File - Quirked) */
[data-theme='black-crown'] .storylet-container {
    background: #fdfaf0;
    padding: 4rem;
    border: 1px solid #ccc;
    box-shadow: var(--shadow-float);
    position: relative;
    max-width: 900px;
    margin: 0 auto 3rem auto;
    
    /* Paper Texture */
    background-image: url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    
    /* Slight rotation for the main file */
    transform: rotate(0.4deg);
    overflow: visible !important;
    height: auto !important;
}

/* 6. OPTIONS (Messy Stack of Index Cards) */
[data-theme='black-crown'] .option-button {
    background-color: var(--bg-item);
    border: 1px solid #d1c8b0;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-paper);
    transition: transform 0.2s ease-out;
    
    /* --- ADD THESE TWO LINES --- */
    position: relative; 
    overflow: visible;
}

/* The "Sticky Tape" on top of each option */
[data-theme='black-crown'] .option-button::before {
    content: '';
    position: absolute;
    
    /* Positioning */
    top: -12px; /* Pulls it up above the button's border */
    left: 50%;
    transform: translateX(-50%) rotate(-2.5deg); /* Center horizontally with a slight tilt */
    
    /* Size */
    width: 120px;
    height: 28px;
    
    /* Appearance of old, semi-transparent tape */
    background: rgba(255, 255, 220, 0.3); /* Yellowish tint */
    border-left: 1px solid rgba(200, 200, 150, 0.4);
    border-right: 1px solid rgba(200, 200, 150, 0.4);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(1px); /* A subtle glass-like effect */
}

/* Alternating rotations for the messy look */
[data-theme='black-crown'] .option-button:nth-child(odd) {
    transform: rotate(-0.6deg);
}
[data-theme='black-crown'] .option-button:nth-child(even) {
    transform: rotate(0.6deg);
}

[data-theme='black-crown'] .option-button:hover {
    background-color: #fff;
    transform: scale(1.01) rotate(0deg) translateY(-3px); /* Straighten up on hover */
    border-color: #999;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    z-index: 5;
}

/* 7. IMAGES (Polaroids & Paperclips) */
[data-theme='black-crown'] .storylet-image-container {
    background: #fff;
    padding: 0.5rem 0.5rem 2.5rem 0.5rem;
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    border: 1px solid #ddd;
    /* Stronger rotation for images */
    transform: rotate(-2deg);
    max-width: 250px; 
    flex-shrink: 0;
    position: relative;
}

/* CSS Paperclip on the image */
[data-theme='black-crown'] .storylet-image-container::before {
    content: '';
    position: absolute;
    top: -10px; left: 15px;
    width: 12px; height: 35px;
    border: 3px solid #666;
    border-radius: 10px;
    background: transparent;
    z-index: 10;
    box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

/* 8. SCROLLBARS */
[data-theme='black-crown'] ::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}
[data-theme='black-crown'] ::-webkit-scrollbar-track {
    background: #0f1a0f; 
}
[data-theme='black-crown'] ::-webkit-scrollbar-thumb {
    background: #5c554a;
    border: 3px solid #0f1a0f; 
    border-radius: 6px;
}
/* --- UNIVERSAL TEXT STYLES (Apply to all themes) --- */

.text-emphasis {
    /* This automatically picks up the Red color in Black Crown, 
       but will be Blue/Gold/etc in your other themes */
    color: var(--accent-highlight);
    /* Optional: Black Crown uses underlines for emphasis */
    text-decoration: inherit; 
}

/* --- DASHBOARD CARD OVERRIDES --- */
/* Target elements that are BOTH a card and a theme-wrapper */
.card.theme-wrapper {
    /* Force the card to behave like a standard box, ignoring theme layout quirks */
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    min-height: 250px; /* Ensure a good aspect ratio */
    border: 1px solid var(--border-color) !important;
    border-radius: 8px !important;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;
    transform: none !important; /* Stop the Black Crown rotation in the grid */
    margin: 0 !important;
    background-color: var(--bg-panel) !important;
    padding: 0 !important; /* Let the internal divs handle padding */
    overflow: hidden !important;
}

/* Fix the Content Container inside */
.card.theme-wrapper > div:last-child {
    padding: 1.5rem !important;
    display: flex !important;
    flex-direction: column !important;
    flex: 1 1 auto !important;
}

/* Force the Button Container to sit at the bottom */
.card.theme-wrapper > div:last-child > div:last-child {
    margin-top: auto !important;
    display: flex !important;
    flex-direction: row !important; /* Force Side-by-Side */
    gap: 10px !important;
    width: 100% !important;
}

/* FIX THE BUTTONS specifically within these cards */
.card.theme-wrapper .continue-button,
.card.theme-wrapper .return-button {
    /* Reset dimensions to fill the flex row properly */
    width: auto !important;
    height: auto !important;
    flex: 1 1 0% !important; /* Share width equally */
    
    /* Reset typography and padding */
    padding: 0.5rem 1rem !important;
    font-size: 0.9rem !important;
    line-height: 1.5 !important;
    text-align: center !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    
    /* Ensure they look like buttons */
    border: 1px solid var(--border-color) !important;
    border-radius: 4px !important;
    background: var(--bg-item) !important;
    color: var(--text-primary) !important;
    text-decoration: none !important;
    
    /* Stop any absolute positioning or transform from themes */
    position: static !important;
    transform: none !important;
    box-shadow: none !important;
}

/* Hover effects for dashboard buttons */
.card.theme-wrapper .continue-button:hover,
.card.theme-wrapper .return-button:hover {
    background: var(--accent-primary) !important;
    color: #fff !important;
    border-color: var(--accent-primary) !important;
}

/* Specific Fix for Black Crown image container within Dashboard */
.card.theme-wrapper[data-theme='black-crown'] > div:first-child {
    border-bottom: 2px solid #000 !important;
    padding: 0 !important; /* Remove the polaroid padding */
    background: #000 !important;
    transform: none !important; /* Remove rotation */
    width: 100% !important;
}

/* Ensure images fit */
.card.theme-wrapper img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    border: none !important; /* Remove polaroid borders */
    filter: none !important; /* Remove sepia filters in dashboard */
}

.special-block-text {
    text-align: center;
    font-family: var(--font-main);
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin: 1.5rem 0;
    padding: 0.5rem;
}

/*The part which renders just HTML */
html {
    scroll-behavior: smooth;
}

.toc-link:hover {
    color: #61afef !important;
}
